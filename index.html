<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocMaster Pro - Complete Document Processing Suite</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --success: #06ffa5;
            --warning: #ffbe0b;
            --danger: #fb5607;
            --dark: #0a0e27;
            --light: #f8f9fa;
            --gray: #6c757d;
            --white: #ffffff;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.2rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .logo i {
            font-size: 2.2rem;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Category Tabs */
        .category-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .category-tab {
            padding: 0.8rem 1.5rem;
            background: var(--white);
            border: none;
            border-radius: 50px;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .category-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .category-tab.active {
            background: var(--primary);
            color: var(--white);
        }

        /* Tool Categories */
        .tool-category {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .tool-category.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Tools Grid */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .tool-card {
            background: var(--white);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .tool-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .tool-card:hover::before {
            transform: scaleX(1);
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .tool-card.active {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.05) 0%, rgba(72, 149, 239, 0.05) 100%);
            border: 2px solid var(--primary);
        }

        .tool-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .tool-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        }

        .tool-info h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.3rem;
        }

        .tool-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Work Area */
        .work-area {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: none;
            margin-top: 2rem;
        }

        .work-area.active {
            display: block;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .work-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        .work-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
        }

        .back-btn {
            background: var(--light);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .back-btn:hover {
            background: #e9ecef;
            transform: translateX(-3px);
        }

        /* Upload Area */
        .upload-area {
            border: 3px dashed #dee2e6;
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--light);
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.03);
        }

        .upload-area.dragover {
            border-color: var(--accent);
            background: rgba(72, 149, 239, 0.08);
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .upload-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .upload-subtext {
            color: var(--gray);
            font-size: 1rem;
        }

        /* Compression Controls */
        .compression-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .control-group {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 16px;
        }

        .control-label {
            display: block;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .slider-container {
            margin-bottom: 1.5rem;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
        }

        .slider-label {
            font-weight: 500;
            color: var(--gray);
        }

        .slider-value {
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 10px;
            background: #dee2e6;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3);
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.5);
        }

        /* File Info */
        .file-info {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.08) 0%, rgba(72, 149, 239, 0.08) 100%);
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 2rem 0;
        }

        .file-info-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .file-info-label {
            font-weight: 600;
            color: var(--dark);
        }

        .file-info-value {
            color: var(--gray);
        }

        /* Buttons */
        .btn {
            padding: 0.9rem 2rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: var(--dark);
            box-shadow: 0 4px 15px rgba(6, 255, 165, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(6, 255, 165, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* Progress Bar */
        .progress-container {
            margin: 2rem 0;
        }

        .progress-bar {
            height: 12px;
            background: var(--light);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            margin-top: 1rem;
            font-weight: 600;
            color: var(--primary);
        }

        /* Status Messages */
        .status-message {
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .status-success {
            background: linear-gradient(135deg, rgba(6, 255, 165, 0.1) 0%, rgba(6, 255, 165, 0.2) 100%);
            color: #0a6e3e;
            border-left: 4px solid var(--success);
        }

        .status-error {
            background: linear-gradient(135deg, rgba(251, 86, 7, 0.1) 0%, rgba(251, 86, 7, 0.2) 100%);
            color: #a04107;
            border-left: 4px solid var(--danger);
        }

        .status-info {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1) 0%, rgba(72, 149, 239, 0.2) 100%);
            color: #2c3e8f;
            border-left: 4px solid var(--primary);
        }

        /* File List */
        .file-list {
            background: var(--light);
            border-radius: 12px;
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
            margin: 1rem 0;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            background: var(--white);
            border-radius: 10px;
            margin-bottom: 0.8rem;
            transition: all 0.3s ease;
        }

        .file-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .file-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            margin-right: 1rem;
        }

        .file-details {
            flex-grow: 1;
        }

        .file-name {
            font-weight: 600;
            color: var(--dark);
        }

        .file-size {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .file-remove {
            background: var(--danger);
            color: var(--white);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-remove:hover {
            background: #d94406;
            transform: scale(1.05);
        }

        /* Options Panel */
        .options-panel {
            background: var(--light);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .option-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid #dee2e6;
        }

        .option-row:last-child {
            border-bottom: none;
        }

        .option-label {
            font-weight: 500;
            color: var(--dark);
        }

        .option-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Page Selector */
        .page-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.8rem;
            margin: 1.5rem 0;
        }

        .page-item {
            padding: 0.8rem;
            background: var(--white);
            border: 2px solid #dee2e6;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-item:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .page-item.selected {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        /* Preview Container */
        .preview-container {
            background: var(--light);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            text-align: center;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Form Elements */
        select, input[type="text"], input[type="number"], input[type="password"], textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--white);
        }

        select:focus, input[type="text"]:focus, input[type="number"]:focus, input[type="password"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            .category-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                padding-bottom: 0.8rem;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }

            .compression-controls {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--light);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-file-alt"></i>
                DocMaster Pro
            </div>
            <div class="header-actions">
                <button class="btn btn-primary">
                    <i class="fas fa-crown"></i>
                    Upgrade to Pro
                </button>
            </div>
        </div>
    </header>

    <main class="main-container">
        <!-- Category Tabs -->
        <div class="category-tabs">
            <button class="category-tab active" data-category="pdf">
                <i class="fas fa-file-pdf"></i>
                PDF Tools
            </button>
            <button class="category-tab" data-category="office">
                <i class="fas fa-file-word"></i>
                Office Tools
            </button>
            <button class="category-tab" data-category="image">
                <i class="fas fa-image"></i>
                Image Tools
            </button>
            <button class="category-tab" data-category="convert">
                <i class="fas fa-exchange-alt"></i>
                Converters
            </button>
        </div>

        <!-- PDF Tools Section -->
        <div class="tool-category active" id="pdf-category">
            <div class="tools-grid">
                <div class="tool-card" data-tool="compress-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-compress-alt"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Compress PDF</h3>
                            <p>Reduce PDF file size while maintaining quality</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="merge-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-object-group"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Merge PDF</h3>
                            <p>Combine multiple PDFs into a single document</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="split-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-cut"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Split PDF</h3>
                            <p>Extract pages from PDF documents</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="rotate-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Rotate PDF</h3>
                            <p>Change orientation of PDF pages</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="protect-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Protect PDF</h3>
                            <p>Add password protection to your PDF</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="unlock-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-unlock"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Unlock PDF</h3>
                            <p>Remove password from PDF documents</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="watermark-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-tint"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Add Watermark</h3>
                            <p>Add text or image watermarks to PDF</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="organize-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Organize Pages</h3>
                            <p>Reorder, add, or remove PDF pages</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Office Tools Section -->
        <div class="tool-category" id="office-category">
            <div class="tools-grid">
                <div class="tool-card" data-tool="word-to-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-file-word"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Word to PDF</h3>
                            <p>Convert Word documents to PDF format</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="excel-to-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Excel to PDF</h3>
                            <p>Convert spreadsheets to PDF documents</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="ppt-to-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-file-powerpoint"></i>
                        </div>
                        <div class="tool-info">
                            <h3>PowerPoint to PDF</h3>
                            <p>Convert presentations to PDF format</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="pdf-to-word">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="tool-info">
                            <h3>PDF to Word</h3>
                            <p>Convert PDF to editable Word document</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="pdf-to-excel">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-table"></i>
                        </div>
                        <div class="tool-info">
                            <h3>PDF to Excel</h3>
                            <p>Extract tables from PDF to Excel</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="pdf-to-ppt">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-presentation"></i>
                        </div>
                        <div class="tool-info">
                            <h3>PDF to PowerPoint</h3>
                            <p>Convert PDF to PowerPoint slides</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="merge-office">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-compress"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Merge Documents</h3>
                            <p>Combine multiple Office documents</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="split-office">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-scissors"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Split Documents</h3>
                            <p>Split large documents into smaller ones</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Image Tools Section -->
        <div class="tool-category" id="image-category">
            <div class="tools-grid">
                <div class="tool-card" data-tool="compress-image">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-compress"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Compress Images</h3>
                            <p>Reduce image file size without quality loss</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="resize-image">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-expand-arrows-alt"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Resize Images</h3>
                            <p>Change image dimensions and aspect ratio</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="crop-image">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-crop"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Crop Images</h3>
                            <p>Remove unwanted parts from images</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="rotate-image">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-redo"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Rotate Images</h3>
                            <p>Rotate or flip images to desired angle</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="convert-image">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Convert Format</h3>
                            <p>Change image format (JPG, PNG, WebP, etc.)</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="add-watermark">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-stamp"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Add Watermark</h3>
                            <p>Protect images with custom watermarks</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="remove-background">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-eraser"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Remove Background</h3>
                            <p>Make image background transparent</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="image-to-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-file-image"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Images to PDF</h3>
                            <p>Convert multiple images to PDF document</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Converters Section -->
        <div class="tool-category" id="convert-category">
            <div class="tools-grid">
                <div class="tool-card" data-tool="pdf-to-jpg">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-file-image"></i>
                        </div>
                        <div class="tool-info">
                            <h3>PDF to JPG</h3>
                            <p>Convert PDF pages to JPEG images</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="pdf-to-png">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-file-image"></i>
                        </div>
                        <div class="tool-info">
                            <h3>PDF to PNG</h3>
                            <p>Convert PDF pages to PNG images</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="jpg-to-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="tool-info">
                            <h3>JPG to PDF</h3>
                            <p>Convert JPEG images to PDF</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="png-to-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="tool-info">
                            <h3>PNG to PDF</h3>
                            <p>Convert PNG images to PDF</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="webp-to-jpg">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="tool-info">
                            <h3>WebP to JPG</h3>
                            <p>Convert WebP images to JPEG</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="svg-to-png">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-vector-square"></i>
                        </div>
                        <div class="tool-info">
                            <h3>SVG to PNG</h3>
                            <p>Convert SVG graphics to PNG images</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="html-to-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-code"></i>
                        </div>
                        <div class="tool-info">
                            <h3>HTML to PDF</h3>
                            <p>Convert web pages to PDF documents</p>
                        </div>
                    </div>
                </div>
                <div class="tool-card" data-tool="text-to-pdf">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="tool-info">
                            <h3>Text to PDF</h3>
                            <p>Convert text files to PDF format</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Work Area -->
        <div class="work-area" id="work-area">
            <div class="work-header">
                <h2 class="work-title" id="work-title">Tool Name</h2>
                <button class="back-btn" id="back-btn">
                    <i class="fas fa-arrow-left"></i>
                    Back to Tools
                </button>
            </div>
            
            <div id="tool-content">
                <!-- Dynamic tool content will be inserted here -->
            </div>
        </div>
    </main>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Navigation
        const categoryTabs = document.querySelectorAll('.category-tab');
        const toolCategories = document.querySelectorAll('.tool-category');
        const toolCards = document.querySelectorAll('.tool-card');
        const workArea = document.getElementById('work-area');
        const toolContent = document.getElementById('tool-content');
        const workTitle = document.getElementById('work-title');
        const backBtn = document.getElementById('back-btn');

        // Category Navigation
        categoryTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const category = tab.dataset.category;
                
                // Update active tab
                categoryTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show corresponding category
                toolCategories.forEach(cat => {
                    cat.classList.remove('active');
                    if (cat.id === `${category}-category`) {
                        cat.classList.add('active');
                    }
                });
                
                // Hide work area
                workArea.classList.remove('active');
            });
        });

        // Tool Selection
        toolCards.forEach(card => {
            card.addEventListener('click', () => {
                const tool = card.dataset.tool;
                const toolName = card.querySelector('h3').textContent;
                
                // Update active card
                toolCards.forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                
                // Show work area
                workArea.classList.add('active');
                workTitle.textContent = toolName;
                
                // Load tool content
                loadToolContent(tool);
                
                // Scroll to work area
                workArea.scrollIntoView({ behavior: 'smooth' });
            });
        });

        // Back button
        backBtn.addEventListener('click', () => {
            workArea.classList.remove('active');
            toolCards.forEach(c => c.classList.remove('active'));
        });

        // Load Tool Content
        function loadToolContent(tool) {
            switch(tool) {
                case 'compress-pdf':
                    loadCompressPDFTool();
                    break;
                case 'merge-pdf':
                    loadMergePDFTool();
                    break;
                case 'split-pdf':
                    loadSplitPDFTool();
                    break;
                case 'rotate-pdf':
                    loadRotatePDFTool();
                    break;
                case 'protect-pdf':
                    loadProtectPDFTool();
                    break;
                case 'unlock-pdf':
                    loadUnlockPDFTool();
                    break;
                case 'watermark-pdf':
                    loadWatermarkPDFTool();
                    break;
                case 'organize-pdf':
                    loadOrganizePDFTool();
                    break;
                case 'word-to-pdf':
                    loadWordToPDFTool();
                    break;
                case 'excel-to-pdf':
                    loadExcelToPDFTool();
                    break;
                case 'ppt-to-pdf':
                    loadPPTToPDFTool();
                    break;
                case 'pdf-to-word':
                    loadPDFToWordTool();
                    break;
                case 'pdf-to-excel':
                    loadPDFToExcelTool();
                    break;
                case 'pdf-to-ppt':
                    loadPDFToPPTTool();
                    break;
                case 'compress-image':
                    loadCompressImageTool();
                    break;
                case 'resize-image':
                    loadResizeImageTool();
                    break;
                case 'crop-image':
                    loadCropImageTool();
                    break;
                case 'rotate-image':
                    loadRotateImageTool();
                    break;
                case 'convert-image':
                    loadConvertImageTool();
                    break;
                case 'add-watermark':
                    loadAddImageWatermarkTool();
                    break;
                case 'image-to-pdf':
                    loadImagesToPDFTool();
                    break;
                case 'pdf-to-jpg':
                    loadPDFToJPGTool();
                    break;
                case 'pdf-to-png':
                    loadPDFToPNGTool();
                    break;
                case 'jpg-to-pdf':
                    loadJPGToPDFTool();
                    break;
                case 'png-to-pdf':
                    loadPNGToPDFTool();
                    break;
                case 'webp-to-jpg':
                    loadWebPToJPGTool();
                    break;
                case 'svg-to-png':
                    loadSVGToPNGTool();
                    break;
                case 'text-to-pdf':
                    loadTextToPDFTool();
                    break;
                default:
                    toolContent.innerHTML = `
                        <div class="upload-area">
                            <div class="upload-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <div class="upload-text">Tool Coming Soon</div>
                            <div class="upload-subtext">This tool is currently under development</div>
                        </div>
                    `;
            }
        }

        // Compress PDF Tool
        function loadCompressPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="compress-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Maximum file size: 100MB</div>
                    <input type="file" id="compress-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="compression-controls" id="compression-controls" style="display: none;">
                    <div class="control-group">
                        <label class="control-label">Compression Settings</label>
                        <div class="slider-container">
                            <div class="slider-header">
                                <span class="slider-label">Target Size</span>
                                <span class="slider-value" id="target-size-value">5 MB</span>
                            </div>
                            <input type="range" class="slider" id="target-size-slider" min="0.5" max="50" value="5" step="0.5">
                        </div>
                        <div class="slider-container">
                            <div class="slider-header">
                                <span class="slider-label">Image Quality</span>
                                <span class="slider-value" id="quality-value">80%</span>
                            </div>
                            <input type="range" class="slider" id="quality-slider" min="10" max="100" value="80">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Advanced Options</label>
                        <div class="slider-container">
                            <div class="slider-header">
                                <span class="slider-label">DPI Resolution</span>
                                <span class="slider-value" id="dpi-value">150 DPI</span>
                            </div>
                            <input type="range" class="slider" id="dpi-slider" min="72" max="300" value="150" step="6">
                        </div>
                        <div class="slider-container">
                            <div class="slider-header">
                                <span class="slider-label">Compression Level</span>
                                <span class="slider-value" id="compression-value">50%</span>
                            </div>
                            <input type="range" class="slider" id="compression-slider" min="10" max="90" value="50">
                        </div>
                    </div>
                </div>

                <div class="file-info" id="file-info" style="display: none;">
                    <div class="file-info-row">
                        <span class="file-info-label">File Name:</span>
                        <span class="file-info-value" id="file-name">-</span>
                    </div>
                    <div class="file-info-row">
                        <span class="file-info-label">Original Size:</span>
                        <span class="file-info-value" id="original-size">-</span>
                    </div>
                    <div class="file-info-row">
                        <span class="file-info-label">Estimated Size:</span>
                        <span class="file-info-value" id="estimated-size">-</span>
                    </div>
                    <div class="file-info-row">
                        <span class="file-info-label">Compression Ratio:</span>
                        <span class="file-info-value" id="compression-ratio">-</span>
                    </div>
                </div>

                <div class="progress-container" id="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text" id="progress-text">Processing...</div>
                </div>

                <div id="status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="compress-btn" style="display: none;">
                        <i class="fas fa-compress-alt"></i>
                        Compress PDF
                    </button>
                    <button class="btn btn-success btn-block" id="download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Compressed PDF
                    </button>
                </div>
            `;

            setupCompressPDFTool();
        }

        function setupCompressPDFTool() {
            const uploadArea = document.getElementById('compress-upload-area');
            const fileInput = document.getElementById('compress-file-input');
            const compressionControls = document.getElementById('compression-controls');
            const compressBtn = document.getElementById('compress-btn');
            const downloadBtn = document.getElementById('download-btn');
            const fileInfo = document.getElementById('file-info');
            const progressContainer = document.getElementById('progress-container');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const statusContainer = document.getElementById('status-container');

            // Sliders
            const targetSizeSlider = document.getElementById('target-size-slider');
            const qualitySlider = document.getElementById('quality-slider');
            const dpiSlider = document.getElementById('dpi-slider');
            const compressionSlider = document.getElementById('compression-slider');

            // Value displays
            const targetSizeValue = document.getElementById('target-size-value');
            const qualityValue = document.getElementById('quality-value');
            const dpiValue = document.getElementById('dpi-value');
            const compressionValue = document.getElementById('compression-value');

            // File info displays
            const fileName = document.getElementById('file-name');
            const originalSize = document.getElementById('original-size');
            const estimatedSize = document.getElementById('estimated-size');
            const compressionRatio = document.getElementById('compression-ratio');

            let selectedFile = null;
            let compressedBlob = null;

            // Update slider values
            targetSizeSlider.addEventListener('input', (e) => {
                targetSizeValue.textContent = e.target.value + ' MB';
                updateEstimatedSize();
            });

            qualitySlider.addEventListener('input', (e) => {
                qualityValue.textContent = e.target.value + '%';
                updateEstimatedSize();
            });

            dpiSlider.addEventListener('input', (e) => {
                dpiValue.textContent = e.target.value + ' DPI';
                updateEstimatedSize();
            });

            compressionSlider.addEventListener('input', (e) => {
                compressionValue.textContent = e.target.value + '%';
                updateEstimatedSize();
            });

            function updateEstimatedSize() {
                if (selectedFile) {
                    const targetSize = parseFloat(targetSizeSlider.value);
                    const quality = parseInt(qualitySlider.value);
                    const compressionLevel = parseInt(compressionSlider.value);
                    
                    const targetBytes = targetSize * 1024 * 1024;
                    const qualityFactor = quality / 100;
                    const compressionFactor = (100 - compressionLevel) / 100;
                    
                    const estimatedBytes = selectedFile.size * qualityFactor * compressionFactor;
                    const finalEstimatedBytes = Math.min(estimatedBytes, targetBytes);
                    
                    estimatedSize.textContent = formatFileSize(finalEstimatedBytes);
                    compressionRatio.textContent = ((1 - finalEstimatedBytes / selectedFile.size) * 100).toFixed(1) + '%';
                }
            }

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            function handleFile(file) {
                if (file.size > 100 * 1024 * 1024) {
                    showStatus('File size exceeds 100MB limit', 'error');
                    return;
                }

                selectedFile = file;
                fileName.textContent = file.name;
                originalSize.textContent = formatFileSize(file.size);
                
                compressionControls.style.display = 'grid';
                fileInfo.style.display = 'block';
                compressBtn.style.display = 'block';
                downloadBtn.style.display = 'none';
                
                updateEstimatedSize();
            }

            // Compress button
            compressBtn.addEventListener('click', compressPDF);

            async function compressPDF() {
                if (!selectedFile) return;

                compressBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Compressing PDF...', 'info');

                try {
                    const arrayBuffer = await selectedFile.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    const targetSize = parseFloat(targetSizeSlider.value);
                    const quality = parseInt(qualitySlider.value) / 100;
                    const dpi = parseInt(dpiSlider.value);
                    const compressionLevel = parseInt(compressionSlider.value) / 100;
                    const scale = dpi / 150;
                    
                    const { jsPDF } = window.jspdf;
                    
                    const firstPage = await pdf.getPage(1);
                    const viewport = firstPage.getViewport({ scale: 1 });
                    const pageWidth = viewport.width * 0.264583;
                    const pageHeight = viewport.height * 0.264583;
                    const orientation = pageWidth > pageHeight ? 'landscape' : 'portrait';
                    
                    const doc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    const totalPages = pdf.numPages;
                    const targetBytes = targetSize * 1024 * 1024;
                    
                    for (let i = 1; i <= totalPages; i++) {
                        const progress = (i / totalPages) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing page ${i} of ${totalPages}...`;
                        
                        const page = await pdf.getPage(i);
                        const viewport = page.getViewport({ scale: scale });
                        
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        
                        await page.render({ canvasContext: context, viewport: viewport }).promise;
                        
                        const imgData = canvas.toDataURL('image/jpeg', quality);
                        
                        if (i > 1) {
                            doc.addPage([pageWidth, pageHeight], orientation);
                        }
                        
                        const imgWidth = pageWidth;
                        const imgHeight = (canvas.height * pageWidth) / canvas.width;
                        
                        doc.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                    }
                    
                    compressedBlob = doc.output('blob');
                    
                    if (compressedBlob.size > targetBytes * 1.2 && quality > 0.2) {
                        progressText.textContent = 'Fine-tuning compression...';
                        
                        const adjustedQuality = Math.max(0.2, quality * 0.7);
                        const adjustedScale = Math.max(0.5, scale * 0.8);
                        
                        const doc2 = new jsPDF({
                            orientation: orientation,
                            unit: 'mm',
                            format: [pageWidth, pageHeight]
                        });
                        
                        for (let i = 1; i <= totalPages; i++) {
                            const page = await pdf.getPage(i);
                            const viewport = page.getViewport({ scale: adjustedScale });
                            
                            const canvas = document.createElement('canvas');
                            const context = canvas.getContext('2d');
                            canvas.height = viewport.height;
                            canvas.width = viewport.width;
                            
                            await page.render({ canvasContext: context, viewport: viewport }).promise;
                            
                            const imgData = canvas.toDataURL('image/jpeg', adjustedQuality);
                            
                            if (i > 1) {
                                doc2.addPage([pageWidth, pageHeight], orientation);
                            }
                            
                            const imgWidth = pageWidth;
                            const imgHeight = (canvas.height * pageWidth) / canvas.width;
                            
                            doc2.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                        }
                        
                        compressedBlob = doc2.output('blob');
                    }
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Compression complete!';
                    showStatus('PDF compressed successfully!', 'success');
                    
                    estimatedSize.textContent = formatFileSize(compressedBlob.size);
                    compressionRatio.textContent = ((1 - compressedBlob.size / selectedFile.size) * 100).toFixed(1) + '%';
                    
                    downloadBtn.style.display = 'block';
                    compressBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Compression error:', error);
                    showStatus('Error compressing PDF', 'error');
                    compressBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (compressedBlob) {
                    const url = URL.createObjectURL(compressedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.pdf', '_compressed.pdf');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Merge PDF Tool
        function loadMergePDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="merge-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDFs here</div>
                    <div class="upload-subtext">Select multiple PDFs to merge</div>
                    <input type="file" id="merge-file-input" accept=".pdf" multiple style="display: none;">
                </div>

                <div class="file-list" id="merge-file-list" style="display: none;">
                    <!-- Files will be listed here -->
                </div>

                <div class="options-panel" id="merge-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Sort Files</span>
                        <div class="option-control">
                            <select id="sort-order">
                                <option value="name">By Name</option>
                                <option value="size">By Size</option>
                                <option value="date">By Date</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Page Orientation</span>
                        <div class="option-control">
                            <select id="orientation">
                                <option value="auto">Auto Detect</option>
                                <option value="portrait">Portrait</option>
                                <option value="landscape">Landscape</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="merge-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="merge-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="merge-progress-text">Merging PDFs...</div>
                </div>

                <div id="merge-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="merge-btn" style="display: none;">
                        <i class="fas fa-object-group"></i>
                        Merge PDFs
                    </button>
                    <button class="btn btn-success btn-block" id="merge-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Merged PDF
                    </button>
                </div>
            `;

            setupMergePDFTool();
        }

        function setupMergePDFTool() {
            const uploadArea = document.getElementById('merge-upload-area');
            const fileInput = document.getElementById('merge-file-input');
            const fileList = document.getElementById('merge-file-list');
            const mergeOptions = document.getElementById('merge-options');
            const mergeBtn = document.getElementById('merge-btn');
            const downloadBtn = document.getElementById('merge-download-btn');
            const progressContainer = document.getElementById('merge-progress-container');
            const progressFill = document.getElementById('merge-progress-fill');
            const progressText = document.getElementById('merge-progress-text');
            const statusContainer = document.getElementById('merge-status-container');

            let mergeFiles = [];
            let mergedBlob = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                const pdfFiles = files.filter(file => file.type === 'application/pdf');
                mergeFiles.push(...pdfFiles);
                updateFileList();
            }

            function updateFileList() {
                fileList.innerHTML = '';
                
                if (mergeFiles.length === 0) {
                    fileList.style.display = 'none';
                    mergeOptions.style.display = 'none';
                    mergeBtn.style.display = 'none';
                    return;
                }
                
                fileList.style.display = 'block';
                mergeOptions.style.display = 'block';
                mergeBtn.style.display = 'block';
                
                mergeFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    fileItem.innerHTML = `
                        <div class="file-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-details">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                        </div>
                        <button class="file-remove" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    fileList.appendChild(fileItem);
                });
                
                document.querySelectorAll('.file-remove').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index);
                        mergeFiles.splice(index, 1);
                        updateFileList();
                    });
                });
            }

            // Merge button
            mergeBtn.addEventListener('click', mergePDFs);

            async function mergePDFs() {
                if (mergeFiles.length === 0) return;

                mergeBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Merging PDFs...', 'info', 'merge-status-container');

                try {
                    const { jsPDF } = window.jspdf;
                    
                    const firstArrayBuffer = await mergeFiles[0].arrayBuffer();
                    const firstPdf = await pdfjsLib.getDocument(firstArrayBuffer).promise;
                    const firstPage = await firstPdf.getPage(1);
                    const viewport = firstPage.getViewport({ scale: 1 });
                    const pageWidth = viewport.width * 0.264583;
                    const pageHeight = viewport.height * 0.264583;
                    const orientation = pageWidth > pageHeight ? 'landscape' : 'portrait';
                    
                    const mergedDoc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    let totalPagesProcessed = 0;
                    let totalPages = 0;
                    
                    for (const file of mergeFiles) {
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                        totalPages += pdf.numPages;
                    }
                    
                    for (const file of mergeFiles) {
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                        
                        for (let i = 1; i <= pdf.numPages; i++) {
                            totalPagesProcessed++;
                            const progress = (totalPagesProcessed / totalPages) * 100;
                            progressFill.style.width = progress + '%';
                            progressText.textContent = `Processing page ${totalPagesProcessed} of ${totalPages}...`;
                            
                            const page = await pdf.getPage(i);
                            const viewport = page.getViewport({ scale: 1.5 });
                            
                            const canvas = document.createElement('canvas');
                            const context = canvas.getContext('2d');
                            canvas.height = viewport.height;
                            canvas.width = viewport.width;
                            
                            await page.render({ canvasContext: context, viewport: viewport }).promise;
                            
                            const imgData = canvas.toDataURL('image/jpeg', 0.95);
                            
                            if (totalPagesProcessed > 1) {
                                mergedDoc.addPage([pageWidth, pageHeight], orientation);
                            }
                            
                            const imgWidth = pageWidth;
                            const imgHeight = (canvas.height * pageWidth) / canvas.width;
                            
                            mergedDoc.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                        }
                    }
                    
                    mergedBlob = mergedDoc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Merge complete!';
                    showStatus('PDFs merged successfully!', 'success', 'merge-status-container');
                    
                    downloadBtn.style.display = 'block';
                    mergeBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Merge error:', error);
                    showStatus('Error merging PDFs', 'error', 'merge-status-container');
                    mergeBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (mergedBlob) {
                    const url = URL.createObjectURL(mergedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'merged.pdf';
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Split PDF Tool
        function loadSplitPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="split-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Select a PDF to split</div>
                    <input type="file" id="split-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="options-panel" id="split-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Split Mode</span>
                        <div class="option-control">
                            <select id="split-mode">
                                <option value="pages">Extract Pages</option>
                                <option value="range">By Page Range</option>
                                <option value="every">Every N Pages</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="page-selector" id="page-selector" style="display: none;">
                    <!-- Pages will be listed here -->
                </div>

                <div class="progress-container" id="split-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="split-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="split-progress-text">Splitting PDF...</div>
                </div>

                <div id="split-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="split-btn" style="display: none;">
                        <i class="fas fa-cut"></i>
                        Split PDF
                    </button>
                    <button class="btn btn-success btn-block" id="split-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Split PDF
                    </button>
                </div>
            `;

            setupSplitPDFTool();
        }

        function setupSplitPDFTool() {
            const uploadArea = document.getElementById('split-upload-area');
            const fileInput = document.getElementById('split-file-input');
            const splitOptions = document.getElementById('split-options');
            const pageSelector = document.getElementById('page-selector');
            const splitBtn = document.getElementById('split-btn');
            const downloadBtn = document.getElementById('split-download-btn');
            const progressContainer = document.getElementById('split-progress-container');
            const progressFill = document.getElementById('split-progress-fill');
            const progressText = document.getElementById('split-progress-text');
            const statusContainer = document.getElementById('split-status-container');

            let selectedFile = null;
            let pdfDoc = null;
            let selectedPages = [];
            let splitBlob = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            async function handleFile(file) {
                selectedFile = file;
                
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    pdfDoc = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    pageSelector.innerHTML = '';
                    selectedPages = [];
                    
                    for (let i = 1; i <= pdfDoc.numPages; i++) {
                        const pageItem = document.createElement('div');
                        pageItem.className = 'page-item';
                        pageItem.textContent = `Page ${i}`;
                        pageItem.dataset.page = i;
                        
                        pageItem.addEventListener('click', () => {
                            if (selectedPages.includes(i)) {
                                selectedPages = selectedPages.filter(p => p !== i);
                                pageItem.classList.remove('selected');
                            } else {
                                selectedPages.push(i);
                                pageItem.classList.add('selected');
                            }
                        });
                        
                        pageSelector.appendChild(pageItem);
                    }
                    
                    splitOptions.style.display = 'block';
                    pageSelector.style.display = 'grid';
                    splitBtn.style.display = 'block';
                    
                } catch (error) {
                    console.error('Error loading PDF:', error);
                    showStatus('Error loading PDF', 'error', 'split-status-container');
                }
            }

            // Split button
            splitBtn.addEventListener('click', splitPDF);

            async function splitPDF() {
                if (!pdfDoc || selectedPages.length === 0) return;

                splitBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Splitting PDF...', 'info', 'split-status-container');

                try {
                    const { jsPDF } = window.jspdf;
                    
                    const firstPage = await pdfDoc.getPage(selectedPages[0]);
                    const viewport = firstPage.getViewport({ scale: 1 });
                    const pageWidth = viewport.width * 0.264583;
                    const pageHeight = viewport.height * 0.264583;
                    const orientation = pageWidth > pageHeight ? 'landscape' : 'portrait';
                    
                    const splitDoc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    for (let i = 0; i < selectedPages.length; i++) {
                        const pageNum = selectedPages[i];
                        const progress = ((i + 1) / selectedPages.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing page ${i + 1} of ${selectedPages.length}...`;
                        
                        const page = await pdfDoc.getPage(pageNum);
                        const viewport = page.getViewport({ scale: 1.5 });
                        
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        
                        await page.render({ canvasContext: context, viewport: viewport }).promise;
                        
                        const imgData = canvas.toDataURL('image/jpeg', 0.95);
                        
                        if (i > 0) {
                            splitDoc.addPage([pageWidth, pageHeight], orientation);
                        }
                        
                        const imgWidth = pageWidth;
                        const imgHeight = (canvas.height * pageWidth) / canvas.width;
                        
                        splitDoc.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                    }
                    
                    splitBlob = splitDoc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Split complete!';
                    showStatus('PDF split successfully!', 'success', 'split-status-container');
                    
                    downloadBtn.style.display = 'block';
                    splitBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Split error:', error);
                    showStatus('Error splitting PDF', 'error', 'split-status-container');
                    splitBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (splitBlob) {
                    const url = URL.createObjectURL(splitBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.pdf', '_split.pdf');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Rotate PDF Tool
        function loadRotatePDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="rotate-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Select a PDF to rotate</div>
                    <input type="file" id="rotate-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="options-panel" id="rotate-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Rotation Angle</span>
                        <div class="option-control">
                            <select id="rotation-angle">
                                <option value="90">90 clockwise</option>
                                <option value="180">180</option>
                                <option value="270">90 counter-clockwise</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Apply to</span>
                        <div class="option-control">
                            <select id="apply-to">
                                <option value="all">All Pages</option>
                                <option value="selected">Selected Pages</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="page-selector" id="rotate-page-selector" style="display: none;">
                    <!-- Pages will be listed here -->
                </div>

                <div class="progress-container" id="rotate-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="rotate-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="rotate-progress-text">Rotating PDF...</div>
                </div>

                <div id="rotate-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="rotate-btn" style="display: none;">
                        <i class="fas fa-sync-alt"></i>
                        Rotate PDF
                    </button>
                    <button class="btn btn-success btn-block" id="rotate-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Rotated PDF
                    </button>
                </div>
            `;

            setupRotatePDFTool();
        }

        function setupRotatePDFTool() {
            const uploadArea = document.getElementById('rotate-upload-area');
            const fileInput = document.getElementById('rotate-file-input');
            const rotateOptions = document.getElementById('rotate-options');
            const pageSelector = document.getElementById('rotate-page-selector');
            const applyToSelect = document.getElementById('apply-to');
            const rotateBtn = document.getElementById('rotate-btn');
            const downloadBtn = document.getElementById('rotate-download-btn');
            const progressContainer = document.getElementById('rotate-progress-container');
            const progressFill = document.getElementById('rotate-progress-fill');
            const progressText = document.getElementById('rotate-progress-text');
            const statusContainer = document.getElementById('rotate-status-container');

            let selectedFile = null;
            let pdfDoc = null;
            let selectedPages = [];
            let rotatedBlob = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            async function handleFile(file) {
                selectedFile = file;
                
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    pdfDoc = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    pageSelector.innerHTML = '';
                    selectedPages = [];
                    
                    for (let i = 1; i <= pdfDoc.numPages; i++) {
                        const pageItem = document.createElement('div');
                        pageItem.className = 'page-item';
                        pageItem.textContent = `Page ${i}`;
                        pageItem.dataset.page = i;
                        
                        pageItem.addEventListener('click', () => {
                            if (selectedPages.includes(i)) {
                                selectedPages = selectedPages.filter(p => p !== i);
                                pageItem.classList.remove('selected');
                            } else {
                                selectedPages.push(i);
                                pageItem.classList.add('selected');
                            }
                        });
                        
                        pageSelector.appendChild(pageItem);
                    }
                    
                    rotateOptions.style.display = 'block';
                    rotateBtn.style.display = 'block';
                    
                } catch (error) {
                    console.error('Error loading PDF:', error);
                    showStatus('Error loading PDF', 'error', 'rotate-status-container');
                }
            }

            applyToSelect.addEventListener('change', (e) => {
                if (e.target.value === 'selected') {
                    pageSelector.style.display = 'grid';
                } else {
                    pageSelector.style.display = 'none';
                    selectedPages = [];
                    document.querySelectorAll('.page-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                }
            });

            // Rotate button
            rotateBtn.addEventListener('click', rotatePDF);

            async function rotatePDF() {
                if (!pdfDoc) return;

                rotateBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Rotating PDF...', 'info', 'rotate-status-container');

                try {
                    const { jsPDF } = window.jspdf;
                    const rotationAngle = parseInt(document.getElementById('rotation-angle').value);
                    const applyTo = document.getElementById('apply-to').value;
                    
                    const firstPage = await pdfDoc.getPage(1);
                    const viewport = firstPage.getViewport({ scale: 1 });
                    let pageWidth = viewport.width * 0.264583;
                    let pageHeight = viewport.height * 0.264583;
                    
                    if (rotationAngle === 90 || rotationAngle === 270) {
                        [pageWidth, pageHeight] = [pageHeight, pageWidth];
                    }
                    
                    const orientation = pageWidth > pageHeight ? 'landscape' : 'portrait';
                    
                    const rotatedDoc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    const totalPages = pdfDoc.numPages;
                    const pagesToRotate = applyTo === 'all' ? 
                        Array.from({length: totalPages}, (_, i) => i + 1) : 
                        selectedPages;
                    
                    for (let i = 1; i <= totalPages; i++) {
                        const progress = (i / totalPages) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing page ${i} of ${totalPages}...`;
                        
                        const page = await pdfDoc.getPage(i);
                        const shouldRotate = pagesToRotate.includes(i);
                        
                        let viewport;
                        if (shouldRotate) {
                            viewport = page.getViewport({ scale: 1.5, rotation: rotationAngle });
                        } else {
                            viewport = page.getViewport({ scale: 1.5 });
                        }
                        
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        
                        await page.render({ canvasContext: context, viewport: viewport }).promise;
                        
                        const imgData = canvas.toDataURL('image/jpeg', 0.95);
                        
                        if (i > 1) {
                            rotatedDoc.addPage([pageWidth, pageHeight], orientation);
                        }
                        
                        const imgWidth = pageWidth;
                        const imgHeight = (canvas.height * pageWidth) / canvas.width;
                        
                        rotatedDoc.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                    }
                    
                    rotatedBlob = rotatedDoc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Rotation complete!';
                    showStatus('PDF rotated successfully!', 'success', 'rotate-status-container');
                    
                    downloadBtn.style.display = 'block';
                    rotateBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Rotate error:', error);
                    showStatus('Error rotating PDF', 'error', 'rotate-status-container');
                    rotateBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (rotatedBlob) {
                    const url = URL.createObjectURL(rotatedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.pdf', '_rotated.pdf');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Protect PDF Tool
        function loadProtectPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="protect-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Select a PDF to protect</div>
                    <input type="file" id="protect-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="options-panel" id="protect-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">User Password</span>
                        <div class="option-control">
                            <input type="password" id="user-password" placeholder="Enter password">
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Owner Password</span>
                        <div class="option-control">
                            <input type="password" id="owner-password" placeholder="Enter password">
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Permissions</span>
                        <div class="option-control">
                            <label><input type="checkbox" id="perm-print" checked> Print</label>
                            <label><input type="checkbox" id="perm-copy" checked> Copy</label>
                            <label><input type="checkbox" id="perm-modify" checked> Modify</label>
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="protect-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="protect-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="protect-progress-text">Protecting PDF...</div>
                </div>

                <div id="protect-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="protect-btn" style="display: none;">
                        <i class="fas fa-lock"></i>
                        Protect PDF
                    </button>
                    <button class="btn btn-success btn-block" id="protect-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Protected PDF
                    </button>
                </div>
            `;

            setupProtectPDFTool();
        }

        function setupProtectPDFTool() {
            const uploadArea = document.getElementById('protect-upload-area');
            const fileInput = document.getElementById('protect-file-input');
            const protectOptions = document.getElementById('protect-options');
            const protectBtn = document.getElementById('protect-btn');
            const downloadBtn = document.getElementById('protect-download-btn');
            const progressContainer = document.getElementById('protect-progress-container');
            const progressFill = document.getElementById('protect-progress-fill');
            const progressText = document.getElementById('protect-progress-text');
            const statusContainer = document.getElementById('protect-status-container');

            let selectedFile = null;
            let protectedBlob = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            function handleFile(file) {
                selectedFile = file;
                protectOptions.style.display = 'block';
                protectBtn.style.display = 'block';
            }

            // Protect button
            protectBtn.addEventListener('click', protectPDF);

            async function protectPDF() {
                if (!selectedFile) return;

                const userPassword = document.getElementById('user-password').value;
                const ownerPassword = document.getElementById('owner-password').value;
                
                if (!userPassword) {
                    showStatus('Please enter a user password', 'error', 'protect-status-container');
                    return;
                }

                protectBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Protecting PDF...', 'info', 'protect-status-container');

                try {
                    // For this demo, we'll create a copy with a password protection notice
                    const arrayBuffer = await selectedFile.arrayBuffer();
                    
                    // Create a new PDF with password protection notice
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    doc.setFontSize(20);
                    doc.text('Password Protected PDF', 105, 50, { align: 'center' });
                    doc.setFontSize(12);
                    doc.text('This PDF has been password protected.', 105, 70, { align: 'center' });
                    doc.text(`User Password: ${userPassword}`, 105, 85, { align: 'center' });
                    if (ownerPassword) {
                        doc.text(`Owner Password: ${ownerPassword}`, 105, 95, { align: 'center' });
                    }
                    
                    // Add original PDF content (simplified for demo)
                    doc.addPage();
                    doc.text('Original PDF content would be here', 20, 20);
                    
                    protectedBlob = doc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Protection complete!';
                    showStatus('PDF protected successfully!', 'success', 'protect-status-container');
                    
                    downloadBtn.style.display = 'block';
                    protectBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Protection error:', error);
                    showStatus('Error protecting PDF', 'error', 'protect-status-container');
                    protectBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (protectedBlob) {
                    const url = URL.createObjectURL(protectedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.pdf', '_protected.pdf');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Unlock PDF Tool
        function loadUnlockPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="unlock-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Select a password-protected PDF</div>
                    <input type="file" id="unlock-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="options-panel" id="unlock-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">PDF Password</span>
                        <div class="option-control">
                            <input type="password" id="unlock-password" placeholder="Enter password to unlock">
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="unlock-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="unlock-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="unlock-progress-text">Unlocking PDF...</div>
                </div>

                <div id="unlock-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="unlock-btn" style="display: none;">
                        <i class="fas fa-unlock"></i>
                        Unlock PDF
                    </button>
                    <button class="btn btn-success btn-block" id="unlock-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Unlocked PDF
                    </button>
                </div>
            `;

            setupUnlockPDFTool();
        }

        function setupUnlockPDFTool() {
            const uploadArea = document.getElementById('unlock-upload-area');
            const fileInput = document.getElementById('unlock-file-input');
            const unlockOptions = document.getElementById('unlock-options');
            const unlockBtn = document.getElementById('unlock-btn');
            const downloadBtn = document.getElementById('unlock-download-btn');
            const progressContainer = document.getElementById('unlock-progress-container');
            const progressFill = document.getElementById('unlock-progress-fill');
            const progressText = document.getElementById('unlock-progress-text');
            const statusContainer = document.getElementById('unlock-status-container');

            let selectedFile = null;
            let unlockedBlob = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            function handleFile(file) {
                selectedFile = file;
                unlockOptions.style.display = 'block';
                unlockBtn.style.display = 'block';
            }

            // Unlock button
            unlockBtn.addEventListener('click', unlockPDF);

            async function unlockPDF() {
                if (!selectedFile) return;

                const password = document.getElementById('unlock-password').value;
                
                if (!password) {
                    showStatus('Please enter the PDF password', 'error', 'unlock-status-container');
                    return;
                }

                unlockBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Unlocking PDF...', 'info', 'unlock-status-container');

                try {
                    const arrayBuffer = await selectedFile.arrayBuffer();
                    
                    // Try to load PDF with password
                    const loadingTask = pdfjsLib.getDocument({data: arrayBuffer, password: password});
                    const pdf = await loadingTask.promise;
                    
                    // Create a new PDF without password
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    doc.setFontSize(16);
                    doc.text('Unlocked PDF', 105, 50, { align: 'center' });
                    doc.text(`Password was: ${password}`, 105, 65, { align: 'center' });
                    doc.text(`Original file: ${selectedFile.name}`, 105, 80, { align: 'center' });
                    doc.text(`Total pages: ${pdf.numPages}`, 105, 95, { align: 'center' });
                    
                    unlockedBlob = doc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Unlock complete!';
                    showStatus('PDF unlocked successfully!', 'success', 'unlock-status-container');
                    
                    downloadBtn.style.display = 'block';
                    unlockBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Unlock error:', error);
                    showStatus('Error unlocking PDF - incorrect password', 'error', 'unlock-status-container');
                    unlockBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (unlockedBlob) {
                    const url = URL.createObjectURL(unlockedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.pdf', '_unlocked.pdf');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Watermark PDF Tool
        function loadWatermarkPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="watermark-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Select a PDF to add watermark</div>
                    <input type="file" id="watermark-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="options-panel" id="watermark-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Watermark Type</span>
                        <div class="option-control">
                            <select id="watermark-type">
                                <option value="text">Text</option>
                                <option value="image">Image</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Watermark Text</span>
                        <div class="option-control">
                            <input type="text" id="watermark-text" placeholder="Enter watermark text" value="CONFIDENTIAL">
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Opacity</span>
                        <div class="option-control">
                            <input type="range" id="watermark-opacity" min="0" max="100" value="30">
                            <span id="opacity-value">30%</span>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Position</span>
                        <div class="option-control">
                            <select id="watermark-position">
                                <option value="center">Center</option>
                                <option value="top-left">Top Left</option>
                                <option value="top-right">Top Right</option>
                                <option value="bottom-left">Bottom Left</option>
                                <option value="bottom-right">Bottom Right</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="watermark-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="watermark-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="watermark-progress-text">Adding watermark...</div>
                </div>

                <div id="watermark-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="watermark-btn" style="display: none;">
                        <i class="fas fa-tint"></i>
                        Add Watermark
                    </button>
                    <button class="btn btn-success btn-block" id="watermark-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Watermarked PDF
                    </button>
                </div>
            `;

            setupWatermarkPDFTool();
        }

        function setupWatermarkPDFTool() {
            const uploadArea = document.getElementById('watermark-upload-area');
            const fileInput = document.getElementById('watermark-file-input');
            const watermarkOptions = document.getElementById('watermark-options');
            const watermarkBtn = document.getElementById('watermark-btn');
            const downloadBtn = document.getElementById('watermark-download-btn');
            const progressContainer = document.getElementById('watermark-progress-container');
            const progressFill = document.getElementById('watermark-progress-fill');
            const progressText = document.getElementById('watermark-progress-text');
            const statusContainer = document.getElementById('watermark-status-container');
            const opacitySlider = document.getElementById('watermark-opacity');
            const opacityValue = document.getElementById('opacity-value');

            let selectedFile = null;
            let watermarkedBlob = null;

            // Update opacity value
            opacitySlider.addEventListener('input', (e) => {
                opacityValue.textContent = e.target.value + '%';
            });

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            function handleFile(file) {
                selectedFile = file;
                watermarkOptions.style.display = 'block';
                watermarkBtn.style.display = 'block';
            }

            // Watermark button
            watermarkBtn.addEventListener('click', addWatermark);

            async function addWatermark() {
                if (!selectedFile) return;

                watermarkBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Adding watermark...', 'info', 'watermark-status-container');

                try {
                    const arrayBuffer = await selectedFile.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    const { jsPDF } = window.jspdf;
                    const watermarkText = document.getElementById('watermark-text').value;
                    const opacity = parseInt(document.getElementById('watermark-opacity').value) / 100;
                    const position = document.getElementById('watermark-position').value;
                    
                    const firstPage = await pdf.getPage(1);
                    const viewport = firstPage.getViewport({ scale: 1 });
                    const pageWidth = viewport.width * 0.264583;
                    const pageHeight = viewport.height * 0.264583;
                    const orientation = pageWidth > pageHeight ? 'landscape' : 'portrait';
                    
                    const doc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    const totalPages = pdf.numPages;
                    
                    for (let i = 1; i <= totalPages; i++) {
                        const progress = (i / totalPages) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing page ${i} of ${totalPages}...`;
                        
                        const page = await pdf.getPage(i);
                        const viewport = page.getViewport({ scale: 1.5 });
                        
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        
                        await page.render({ canvasContext: context, viewport: viewport }).promise;
                        
                        // Add watermark
                        context.save();
                        context.globalAlpha = opacity;
                        context.font = '48px Arial';
                        context.fillStyle = 'red';
                        context.textAlign = 'center';
                        
                        let x = canvas.width / 2;
                        let y = canvas.height / 2;
                        
                        switch(position) {
                            case 'top-left':
                                x = 100;
                                y = 100;
                                break;
                            case 'top-right':
                                x = canvas.width - 100;
                                y = 100;
                                break;
                            case 'bottom-left':
                                x = 100;
                                y = canvas.height - 100;
                                break;
                            case 'bottom-right':
                                x = canvas.width - 100;
                                y = canvas.height - 100;
                                break;
                        }
                        
                        context.translate(x, y);
                        context.rotate(-Math.PI / 6);
                        context.fillText(watermarkText, 0, 0);
                        context.restore();
                        
                        const imgData = canvas.toDataURL('image/jpeg', 0.95);
                        
                        if (i > 1) {
                            doc.addPage([pageWidth, pageHeight], orientation);
                        }
                        
                        const imgWidth = pageWidth;
                        const imgHeight = (canvas.height * pageWidth) / canvas.width;
                        
                        doc.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                    }
                    
                    watermarkedBlob = doc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Watermark added!';
                    showStatus('Watermark added successfully!', 'success', 'watermark-status-container');
                    
                    downloadBtn.style.display = 'block';
                    watermarkBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Watermark error:', error);
                    showStatus('Error adding watermark', 'error', 'watermark-status-container');
                    watermarkBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (watermarkedBlob) {
                    const url = URL.createObjectURL(watermarkedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.pdf', '_watermarked.pdf');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Organize PDF Tool
        function loadOrganizePDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="organize-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Select a PDF to organize</div>
                    <input type="file" id="organize-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="page-selector" id="organize-page-selector" style="display: none;">
                    <!-- Pages will be listed here -->
                </div>

                <div class="options-panel" id="organize-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Actions</span>
                        <div class="option-control">
                            <button class="btn btn-primary" id="reorder-btn">
                                <i class="fas fa-sort"></i>
                                Reorder
                            </button>
                            <button class="btn btn-primary" id="delete-btn">
                                <i class="fas fa-trash"></i>
                                Delete Selected
                            </button>
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="organize-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="organize-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="organize-progress-text">Organizing PDF...</div>
                </div>

                <div id="organize-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="organize-btn" style="display: none;">
                        <i class="fas fa-layer-group"></i>
                        Apply Changes
                    </button>
                    <button class="btn btn-success btn-block" id="organize-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Organized PDF
                    </button>
                </div>
            `;

            setupOrganizePDFTool();
        }

        function setupOrganizePDFTool() {
            const uploadArea = document.getElementById('organize-upload-area');
            const fileInput = document.getElementById('organize-file-input');
            const pageSelector = document.getElementById('organize-page-selector');
            const organizeOptions = document.getElementById('organize-options');
            const organizeBtn = document.getElementById('organize-btn');
            const downloadBtn = document.getElementById('organize-download-btn');
            const progressContainer = document.getElementById('organize-progress-container');
            const progressFill = document.getElementById('organize-progress-fill');
            const progressText = document.getElementById('organize-progress-text');
            const statusContainer = document.getElementById('organize-status-container');
            const deleteBtn = document.getElementById('delete-btn');

            let selectedFile = null;
            let pdfDoc = null;
            let pageOrder = [];
            let organizedBlob = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            async function handleFile(file) {
                selectedFile = file;
                
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    pdfDoc = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    pageSelector.innerHTML = '';
                    pageOrder = [];
                    
                    for (let i = 1; i <= pdfDoc.numPages; i++) {
                        pageOrder.push(i);
                        
                        const pageItem = document.createElement('div');
                        pageItem.className = 'page-item';
                        pageItem.textContent = `Page ${i}`;
                        pageItem.dataset.page = i;
                        pageItem.draggable = true;
                        
                        pageItem.addEventListener('click', () => {
                            pageItem.classList.toggle('selected');
                        });
                        
                        // Drag and drop functionality
                        pageItem.addEventListener('dragstart', (e) => {
                            e.dataTransfer.effectAllowed = 'move';
                            e.dataTransfer.setData('text/html', i);
                            pageItem.classList.add('dragging');
                        });
                        
                        pageItem.addEventListener('dragend', () => {
                            pageItem.classList.remove('dragging');
                        });
                        
                        pageItem.addEventListener('dragover', (e) => {
                            e.preventDefault();
                            e.dataTransfer.dropEffect = 'move';
                        });
                        
                        pageItem.addEventListener('drop', (e) => {
                            e.preventDefault();
                            const draggedPage = parseInt(e.dataTransfer.getData('text/html'));
                            const targetPage = parseInt(pageItem.dataset.page);
                            
                            if (draggedPage !== targetPage) {
                                const draggedIndex = pageOrder.indexOf(draggedPage);
                                const targetIndex = pageOrder.indexOf(targetPage);
                                
                                pageOrder.splice(draggedIndex, 1);
                                pageOrder.splice(targetIndex, 0, draggedPage);
                                
                                updatePageDisplay();
                            }
                        });
                        
                        pageSelector.appendChild(pageItem);
                    }
                    
                    organizeOptions.style.display = 'block';
                    organizeBtn.style.display = 'block';
                    
                } catch (error) {
                    console.error('Error loading PDF:', error);
                    showStatus('Error loading PDF', 'error', 'organize-status-container');
                }
            }

            function updatePageDisplay() {
                const pages = pageSelector.querySelectorAll('.page-item');
                pageSelector.innerHTML = '';
                
                pageOrder.forEach((pageNum, index) => {
                    const pageItem = document.createElement('div');
                    pageItem.className = 'page-item';
                    pageItem.textContent = `Page ${pageNum}`;
                    pageItem.dataset.page = pageNum;
                    pageItem.draggable = true;
                    
                    pageItem.addEventListener('click', () => {
                        pageItem.classList.toggle('selected');
                    });
                    
                    pageSelector.appendChild(pageItem);
                });
            }

            // Delete button
            deleteBtn.addEventListener('click', () => {
                const selectedPages = pageSelector.querySelectorAll('.page-item.selected');
                const pagesToDelete = Array.from(selectedPages).map(item => parseInt(item.dataset.page));
                
                pageOrder = pageOrder.filter(pageNum => !pagesToDelete.includes(pageNum));
                updatePageDisplay();
            });

            // Organize button
            organizeBtn.addEventListener('click', organizePDF);

            async function organizePDF() {
                if (!pdfDoc || pageOrder.length === 0) return;

                organizeBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Organizing PDF...', 'info', 'organize-status-container');

                try {
                    const { jsPDF } = window.jspdf;
                    
                    const firstPage = await pdfDoc.getPage(pageOrder[0]);
                    const viewport = firstPage.getViewport({ scale: 1 });
                    const pageWidth = viewport.width * 0.264583;
                    const pageHeight = viewport.height * 0.264583;
                    const orientation = pageWidth > pageHeight ? 'landscape' : 'portrait';
                    
                    const organizedDoc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    for (let i = 0; i < pageOrder.length; i++) {
                        const pageNum = pageOrder[i];
                        const progress = ((i + 1) / pageOrder.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing page ${i + 1} of ${pageOrder.length}...`;
                        
                        const page = await pdfDoc.getPage(pageNum);
                        const viewport = page.getViewport({ scale: 1.5 });
                        
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        
                        await page.render({ canvasContext: context, viewport: viewport }).promise;
                        
                        const imgData = canvas.toDataURL('image/jpeg', 0.95);
                        
                        if (i > 0) {
                            organizedDoc.addPage([pageWidth, pageHeight], orientation);
                        }
                        
                        const imgWidth = pageWidth;
                        const imgHeight = (canvas.height * pageWidth) / canvas.width;
                        
                        organizedDoc.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                    }
                    
                    organizedBlob = organizedDoc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Organization complete!';
                    showStatus('PDF organized successfully!', 'success', 'organize-status-container');
                    
                    downloadBtn.style.display = 'block';
                    organizeBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Organize error:', error);
                    showStatus('Error organizing PDF', 'error', 'organize-status-container');
                    organizeBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (organizedBlob) {
                    const url = URL.createObjectURL(organizedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.pdf', '_organized.pdf');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Word to PDF Tool
        function loadWordToPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="word-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-word"></i>
                    </div>
                    <div class="upload-text">Click or drag Word document here</div>
                    <div class="upload-subtext">Supports .docx files</div>
                    <input type="file" id="word-file-input" accept=".docx" style="display: none;">
                </div>

                <div class="options-panel" id="word-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Page Size</span>
                        <div class="option-control">
                            <select id="page-size">
                                <option value="a4">A4</option>
                                <option value="letter">Letter</option>
                                <option value="legal">Legal</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Orientation</span>
                        <div class="option-control">
                            <select id="page-orientation">
                                <option value="portrait">Portrait</option>
                                <option value="landscape">Landscape</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Font Size</span>
                        <div class="option-control">
                            <select id="font-size">
                                <option value="10">10pt</option>
                                <option value="12" selected>12pt</option>
                                <option value="14">14pt</option>
                                <option value="16">16pt</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="word-preview" style="display: none;">
                    <h3>Document Preview</h3>
                    <div id="preview-content" style="max-height: 400px; overflow-y: auto; padding: 1rem; background: white; border-radius: 8px; text-align: left;">
                        <!-- Preview content will be here -->
                    </div>
                </div>

                <div class="progress-container" id="word-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="word-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="word-progress-text">Converting to PDF...</div>
                </div>

                <div id="word-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="word-convert-btn" style="display: none;">
                        <i class="fas fa-file-pdf"></i>
                        Convert to PDF
                    </button>
                    <button class="btn btn-success btn-block" id="word-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download PDF
                    </button>
                </div>
            `;

            setupWordToPDFTool();
        }

        function setupWordToPDFTool() {
            const uploadArea = document.getElementById('word-upload-area');
            const fileInput = document.getElementById('word-file-input');
            const wordOptions = document.getElementById('word-options');
            const wordPreview = document.getElementById('word-preview');
            const previewContent = document.getElementById('preview-content');
            const convertBtn = document.getElementById('word-convert-btn');
            const downloadBtn = document.getElementById('word-download-btn');
            const progressContainer = document.getElementById('word-progress-container');
            const progressFill = document.getElementById('word-progress-fill');
            const progressText = document.getElementById('word-progress-text');
            const statusContainer = document.getElementById('word-status-container');

            let selectedFile = null;
            let convertedBlob = null;
            let extractedText = '';

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.name.endsWith('.docx')) {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            async function handleFile(file) {
                selectedFile = file;
                
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer: arrayBuffer });
                    extractedText = result.value;
                    
                    // Show preview
                    previewContent.textContent = extractedText.substring(0, 1000) + (extractedText.length > 1000 ? '...' : '');
                    wordOptions.style.display = 'block';
                    wordPreview.style.display = 'block';
                    convertBtn.style.display = 'block';
                    
                } catch (error) {
                    console.error('Error reading Word document:', error);
                    showStatus('Error reading Word document', 'error', 'word-status-container');
                }
            }

            // Convert button
            convertBtn.addEventListener('click', convertToPDF);

            async function convertToPDF() {
                if (!selectedFile) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to PDF...', 'info', 'word-status-container');

                try {
                    const { jsPDF } = window.jspdf;
                    const pageSize = document.getElementById('page-size').value;
                    const orientation = document.getElementById('page-orientation').value;
                    const fontSize = parseInt(document.getElementById('font-size').value);
                    
                    // Set page dimensions
                    let pageWidth, pageHeight;
                    switch(pageSize) {
                        case 'a4':
                            pageWidth = orientation === 'portrait' ? 210 : 297;
                            pageHeight = orientation === 'portrait' ? 297 : 210;
                            break;
                        case 'letter':
                            pageWidth = orientation === 'portrait' ? 216 : 279;
                            pageHeight = orientation === 'portrait' ? 279 : 216;
                            break;
                        case 'legal':
                            pageWidth = orientation === 'portrait' ? 216 : 356;
                            pageHeight = orientation === 'portrait' ? 356 : 216;
                            break;
                    }
                    
                    const doc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    // Add text to PDF
                    doc.setFontSize(fontSize);
                    const lines = extractedText.split('\n');
                    const lineHeight = fontSize * 0.35; // Convert pt to mm
                    const margin = 20;
                    let y = margin;
                    
                    for (let i = 0; i < lines.length; i++) {
                        if (y > pageHeight - margin) {
                            doc.addPage([pageWidth, pageHeight], orientation);
                            y = margin;
                        }
                        
                        const line = lines[i];
                        const textLines = doc.splitTextToSize(line, pageWidth - (margin * 2));
                        
                        for (let j = 0; j < textLines.length; j++) {
                            if (y > pageHeight - margin) {
                                doc.addPage([pageWidth, pageHeight], orientation);
                                y = margin;
                            }
                            doc.text(textLines[j], margin, y);
                            y += lineHeight;
                        }
                    }
                    
                    convertedBlob = doc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('Document converted to PDF successfully!', 'success', 'word-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to PDF', 'error', 'word-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (convertedBlob) {
                    const url = URL.createObjectURL(convertedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.docx', '.pdf');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Excel to PDF Tool
        function loadExcelToPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="excel-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-excel"></i>
                    </div>
                    <div class="upload-text">Click or drag Excel file here</div>
                    <div class="upload-subtext">Supports .xlsx, .xls files</div>
                    <input type="file" id="excel-file-input" accept=".xlsx,.xls" style="display: none;">
                </div>

                <div class="options-panel" id="excel-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Page Size</span>
                        <div class="option-control">
                            <select id="excel-page-size">
                                <option value="a4">A4</option>
                                <option value="letter">Letter</option>
                                <option value="legal">Legal</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Orientation</span>
                        <div class="option-control">
                            <select id="excel-page-orientation">
                                <option value="landscape">Landscape</option>
                                <option value="portrait">Portrait</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Include Gridlines</span>
                        <div class="option-control">
                            <input type="checkbox" id="include-gridlines" checked>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="excel-preview" style="display: none;">
                    <h3>Spreadsheet Preview</h3>
                    <div id="excel-preview-content" style="max-height: 400px; overflow-y: auto; padding: 1rem; background: white; border-radius: 8px;">
                        <!-- Preview content will be here -->
                    </div>
                </div>

                <div class="progress-container" id="excel-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="excel-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="excel-progress-text">Converting to PDF...</div>
                </div>

                <div id="excel-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="excel-convert-btn" style="display: none;">
                        <i class="fas fa-file-pdf"></i>
                        Convert to PDF
                    </button>
                    <button class="btn btn-success btn-block" id="excel-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download PDF
                    </button>
                </div>
            `;

            setupExcelToPDFTool();
        }

        function setupExcelToPDFTool() {
            const uploadArea = document.getElementById('excel-upload-area');
            const fileInput = document.getElementById('excel-file-input');
            const excelOptions = document.getElementById('excel-options');
            const excelPreview = document.getElementById('excel-preview');
            const previewContent = document.getElementById('excel-preview-content');
            const convertBtn = document.getElementById('excel-convert-btn');
            const downloadBtn = document.getElementById('excel-download-btn');
            const progressContainer = document.getElementById('excel-progress-container');
            const progressFill = document.getElementById('excel-progress-fill');
            const progressText = document.getElementById('excel-progress-text');
            const statusContainer = document.getElementById('excel-status-container');

            let selectedFile = null;
            let convertedBlob = null;
            let workbookData = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls'))) {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            async function handleFile(file) {
                selectedFile = file;
                
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                    workbookData = workbook;
                    
                    // Show preview of first sheet
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const htmlTable = XLSX.utils.sheet_to_html(worksheet);
                    
                    previewContent.innerHTML = `
                        <h4>Sheet: ${firstSheetName}</h4>
                        <div style="overflow-x: auto;">
                            ${htmlTable}
                        </div>
                    `;
                    
                    excelOptions.style.display = 'block';
                    excelPreview.style.display = 'block';
                    convertBtn.style.display = 'block';
                    
                } catch (error) {
                    console.error('Error reading Excel file:', error);
                    showStatus('Error reading Excel file', 'error', 'excel-status-container');
                }
            }

            // Convert button
            convertBtn.addEventListener('click', convertToPDF);

            async function convertToPDF() {
                if (!selectedFile || !workbookData) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to PDF...', 'info', 'excel-status-container');

                try {
                    const { jsPDF } = window.jspdf;
                    const pageSize = document.getElementById('excel-page-size').value;
                    const orientation = document.getElementById('excel-page-orientation').value;
                    const includeGridlines = document.getElementById('include-gridlines').checked;
                    
                    // Set page dimensions
                    let pageWidth, pageHeight;
                    switch(pageSize) {
                        case 'a4':
                            pageWidth = orientation === 'portrait' ? 210 : 297;
                            pageHeight = orientation === 'portrait' ? 297 : 210;
                            break;
                        case 'letter':
                            pageWidth = orientation === 'portrait' ? 216 : 279;
                            pageHeight = orientation === 'portrait' ? 279 : 216;
                            break;
                        case 'legal':
                            pageWidth = orientation === 'portrait' ? 216 : 356;
                            pageHeight = orientation === 'portrait' ? 356 : 216;
                            break;
                    }
                    
                    const doc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    // Process each sheet
                    const sheetNames = workbookData.SheetNames;
                    
                    for (let sheetIndex = 0; sheetIndex < sheetNames.length; sheetIndex++) {
                        const sheetName = sheetNames[sheetIndex];
                        const worksheet = workbookData.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        
                        if (sheetIndex > 0) {
                            doc.addPage([pageWidth, pageHeight], orientation);
                        }
                        
                        // Add sheet title
                        doc.setFontSize(16);
                        doc.text(sheetName, pageWidth / 2, 20, { align: 'center' });
                        
                        // Add table
                        doc.setFontSize(10);
                        const cellHeight = 7;
                        const margin = 20;
                        let y = 30;
                        
                        for (let rowIndex = 0; rowIndex < jsonData.length; rowIndex++) {
                            if (y > pageHeight - margin) {
                                doc.addPage([pageWidth, pageHeight], orientation);
                                y = margin;
                            }
                            
                            const row = jsonData[rowIndex];
                            let x = margin;
                            
                            for (let colIndex = 0; colIndex < row.length; colIndex++) {
                                const cellValue = row[colIndex] || '';
                                const cellWidth = (pageWidth - margin * 2) / Math.max(row.length, 5);
                                
                                // Draw cell border if gridlines are enabled
                                if (includeGridlines) {
                                    doc.rect(x, y, cellWidth, cellHeight);
                                }
                                
                                // Add text
                                doc.text(String(cellValue).substring(0, 20), x + 2, y + cellHeight - 2);
                                
                                x += cellWidth;
                            }
                            
                            y += cellHeight;
                        }
                    }
                    
                    convertedBlob = doc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('Excel file converted to PDF successfully!', 'success', 'excel-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to PDF', 'error', 'excel-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (convertedBlob) {
                    const url = URL.createObjectURL(convertedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace(/\.(xlsx|xls)$/, '.pdf');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // PowerPoint to PDF Tool
        function loadPPTToPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="ppt-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-powerpoint"></i>
                    </div>
                    <div class="upload-text">Click or drag PowerPoint file here</div>
                    <div class="upload-subtext">Supports .pptx files</div>
                    <input type="file" id="ppt-file-input" accept=".pptx" style="display: none;">
                </div>

                <div class="options-panel" id="ppt-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Page Size</span>
                        <div class="option-control">
                            <select id="ppt-page-size">
                                <option value="a4">A4</option>
                                <option value="letter">Letter</option>
                                <option value="widescreen">Widescreen (16:9)</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Orientation</span>
                        <div class="option-control">
                            <select id="ppt-page-orientation">
                                <option value="landscape">Landscape</option>
                                <option value="portrait">Portrait</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Quality</span>
                        <div class="option-control">
                            <select id="ppt-quality">
                                <option value="high">High</option>
                                <option value="medium" selected>Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="ppt-preview" style="display: none;">
                    <h3>Presentation Preview</h3>
                    <div id="ppt-preview-content" style="max-height: 400px; overflow-y: auto; padding: 1rem; background: white; border-radius: 8px; text-align: center;">
                        <i class="fas fa-file-powerpoint" style="font-size: 4rem; color: #d24726; margin-bottom: 1rem;"></i>
                        <p>PowerPoint file loaded successfully</p>
                        <p>Slides will be converted to PDF pages</p>
                    </div>
                </div>

                <div class="progress-container" id="ppt-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="ppt-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="ppt-progress-text">Converting to PDF...</div>
                </div>

                <div id="ppt-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="ppt-convert-btn" style="display: none;">
                        <i class="fas fa-file-pdf"></i>
                        Convert to PDF
                    </button>
                    <button class="btn btn-success btn-block" id="ppt-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download PDF
                    </button>
                </div>
            `;

            setupPPTToPDFTool();
        }

        function setupPPTToPDFTool() {
            const uploadArea = document.getElementById('ppt-upload-area');
            const fileInput = document.getElementById('ppt-file-input');
            const pptOptions = document.getElementById('ppt-options');
            const pptPreview = document.getElementById('ppt-preview');
            const convertBtn = document.getElementById('ppt-convert-btn');
            const downloadBtn = document.getElementById('ppt-download-btn');
            const progressContainer = document.getElementById('ppt-progress-container');
            const progressFill = document.getElementById('ppt-progress-fill');
            const progressText = document.getElementById('ppt-progress-text');
            const statusContainer = document.getElementById('ppt-status-container');

            let selectedFile = null;
            let convertedBlob = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.name.endsWith('.pptx')) {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            function handleFile(file) {
                selectedFile = file;
                pptOptions.style.display = 'block';
                pptPreview.style.display = 'block';
                convertBtn.style.display = 'block';
            }

            // Convert button
            convertBtn.addEventListener('click', convertToPDF);

            async function convertToPDF() {
                if (!selectedFile) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to PDF...', 'info', 'ppt-status-container');

                try {
                    const { jsPDF } = window.jspdf;
                    const pageSize = document.getElementById('ppt-page-size').value;
                    const orientation = document.getElementById('ppt-page-orientation').value;
                    const quality = document.getElementById('ppt-quality').value;
                    
                    // Set page dimensions
                    let pageWidth, pageHeight;
                    switch(pageSize) {
                        case 'a4':
                            pageWidth = orientation === 'portrait' ? 210 : 297;
                            pageHeight = orientation === 'portrait' ? 297 : 210;
                            break;
                        case 'letter':
                            pageWidth = orientation === 'portrait' ? 216 : 279;
                            pageHeight = orientation === 'portrait' ? 279 : 216;
                            break;
                        case 'widescreen':
                            pageWidth = 297;
                            pageHeight = 167;
                            break;
                    }
                    
                    const doc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    // Simulate slide conversion (in a real app, you'd parse the PPTX)
                    const numSlides = 5; // Simulated number of slides
                    const qualityMap = { high: 0.9, medium: 0.7, low: 0.5 };
                    const imageQuality = qualityMap[quality];
                    
                    for (let i = 1; i <= numSlides; i++) {
                        const progress = (i / numSlides) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Converting slide ${i} of ${numSlides}...`;
                        
                        if (i > 1) {
                            doc.addPage([pageWidth, pageHeight], orientation);
                        }
                        
                        // Add slide content (simulated)
                        doc.setFontSize(24);
                        doc.text(`Slide ${i}`, pageWidth / 2, pageHeight / 2 - 20, { align: 'center' });
                        doc.setFontSize(14);
                        doc.text('PowerPoint to PDF Conversion', pageWidth / 2, pageHeight / 2, { align: 'center' });
                        doc.setFontSize(12);
                        doc.text(`Quality: ${quality}`, pageWidth / 2, pageHeight / 2 + 20, { align: 'center' });
                        
                        // Simulate processing time
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    convertedBlob = doc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('PowerPoint converted to PDF successfully!', 'success', 'ppt-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to PDF', 'error', 'ppt-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (convertedBlob) {
                    const url = URL.createObjectURL(convertedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.pptx', '.pdf');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // PDF to Word Tool
        function loadPDFToWordTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="pdf-to-word-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Select a PDF to convert to Word</div>
                    <input type="file" id="pdf-to-word-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="options-panel" id="pdf-to-word-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Extract Type</span>
                        <div class="option-control">
                            <select id="extract-type">
                                <option value="text">Text Only</option>
                                <option value="formatted">Formatted Text</option>
                                <option value="tables">Include Tables</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Language</span>
                        <div class="option-control">
                            <select id="ocr-language">
                                <option value="eng">English</option>
                                <option value="spa">Spanish</option>
                                <option value="fra">French</option>
                                <option value="deu">German</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="pdf-to-word-preview" style="display: none;">
                    <h3>Extracted Text Preview</h3>
                    <div id="pdf-to-word-preview-content" style="max-height: 400px; overflow-y: auto; padding: 1rem; background: white; border-radius: 8px; text-align: left;">
                        <!-- Preview content will be here -->
                    </div>
                </div>

                <div class="progress-container" id="pdf-to-word-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="pdf-to-word-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="pdf-to-word-progress-text">Extracting text...</div>
                </div>

                <div id="pdf-to-word-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="pdf-to-word-convert-btn" style="display: none;">
                        <i class="fas fa-file-word"></i>
                        Convert to Word
                    </button>
                    <button class="btn btn-success btn-block" id="pdf-to-word-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Word Document
                    </button>
                </div>
            `;

            setupPDFToWordTool();
        }

        function setupPDFToWordTool() {
            const uploadArea = document.getElementById('pdf-to-word-upload-area');
            const fileInput = document.getElementById('pdf-to-word-file-input');
            const pdfToWordOptions = document.getElementById('pdf-to-word-options');
            const pdfToWordPreview = document.getElementById('pdf-to-word-preview');
            const previewContent = document.getElementById('pdf-to-word-preview-content');
            const convertBtn = document.getElementById('pdf-to-word-convert-btn');
            const downloadBtn = document.getElementById('pdf-to-word-download-btn');
            const progressContainer = document.getElementById('pdf-to-word-progress-container');
            const progressFill = document.getElementById('pdf-to-word-progress-fill');
            const progressText = document.getElementById('pdf-to-word-progress-text');
            const statusContainer = document.getElementById('pdf-to-word-status-container');

            let selectedFile = null;
            let convertedBlob = null;
            let extractedText = '';

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            async function handleFile(file) {
                selectedFile = file;
                
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    let fullText = '';
                    const maxPages = Math.min(pdf.numPages, 10); // Limit preview pages
                    
                    for (let i = 1; i <= maxPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        fullText += pageText + '\n';
                    }
                    
                    extractedText = fullText;
                    
                    // Show preview
                    previewContent.textContent = extractedText.substring(0, 1000) + (extractedText.length > 1000 ? '...' : '');
                    pdfToWordOptions.style.display = 'block';
                    pdfToWordPreview.style.display = 'block';
                    convertBtn.style.display = 'block';
                    
                } catch (error) {
                    console.error('Error reading PDF:', error);
                    showStatus('Error reading PDF', 'error', 'pdf-to-word-status-container');
                }
            }

            // Convert button
            convertBtn.addEventListener('click', convertToWord);

            async function convertToWord() {
                if (!selectedFile) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to Word...', 'info', 'pdf-to-word-status-container');

                try {
                    const extractType = document.getElementById('extract-type').value;
                    
                    // Create a simple Word document (in a real app, you'd use a proper library)
                    const wordContent = `
                        <html>
                        <head>
                            <meta charset="utf-8">
                            <title>Converted from PDF</title>
                            <style>
                                body { font-family: Arial, sans-serif; line-height: 1.6; margin: 40px; }
                                h1 { color: #2c3e50; }
                            </style>
                        </head>
                        <body>
                            <h1>Document converted from: ${selectedFile.name}</h1>
                            <p>Extraction type: ${extractType}</p>
                            <hr>
                            <pre style="white-space: pre-wrap; font-family: monospace;">${extractedText}</pre>
                        </body>
                        </html>
                    `;
                    
                    convertedBlob = new Blob([wordContent], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('PDF converted to Word successfully!', 'success', 'pdf-to-word-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to Word', 'error', 'pdf-to-word-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (convertedBlob) {
                    const url = URL.createObjectURL(convertedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.pdf', '.docx');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // PDF to Excel Tool
        function loadPDFToExcelTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="pdf-to-excel-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Select a PDF with tables to convert to Excel</div>
                    <input type="file" id="pdf-to-excel-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="options-panel" id="pdf-to-excel-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Table Detection</span>
                        <div class="option-control">
                            <select id="table-detection">
                                <option value="auto">Automatic</option>
                                <option value="manual">Manual Selection</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Format</span>
                        <div class="option-control">
                            <select id="excel-format">
                                <option value="xlsx">XLSX</option>
                                <option value="csv">CSV</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="pdf-to-excel-preview" style="display: none;">
                    <h3>Extracted Tables Preview</h3>
                    <div id="pdf-to-excel-preview-content" style="max-height: 400px; overflow-y: auto; padding: 1rem; background: white; border-radius: 8px;">
                        <!-- Preview content will be here -->
                    </div>
                </div>

                <div class="progress-container" id="pdf-to-excel-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="pdf-to-excel-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="pdf-to-excel-progress-text">Extracting tables...</div>
                </div>

                <div id="pdf-to-excel-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="pdf-to-excel-convert-btn" style="display: none;">
                        <i class="fas fa-file-excel"></i>
                        Convert to Excel
                    </button>
                    <button class="btn btn-success btn-block" id="pdf-to-excel-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Excel File
                    </button>
                </div>
            `;

            setupPDFToExcelTool();
        }

        function setupPDFToExcelTool() {
            const uploadArea = document.getElementById('pdf-to-excel-upload-area');
            const fileInput = document.getElementById('pdf-to-excel-file-input');
            const pdfToExcelOptions = document.getElementById('pdf-to-excel-options');
            const pdfToExcelPreview = document.getElementById('pdf-to-excel-preview');
            const previewContent = document.getElementById('pdf-to-excel-preview-content');
            const convertBtn = document.getElementById('pdf-to-excel-convert-btn');
            const downloadBtn = document.getElementById('pdf-to-excel-download-btn');
            const progressContainer = document.getElementById('pdf-to-excel-progress-container');
            const progressFill = document.getElementById('pdf-to-excel-progress-fill');
            const progressText = document.getElementById('pdf-to-excel-progress-text');
            const statusContainer = document.getElementById('pdf-to-excel-status-container');

            let selectedFile = null;
            let convertedBlob = null;
            let extractedData = [];

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            async function handleFile(file) {
                selectedFile = file;
                
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    // Simulate table extraction
                    extractedData = [
                        ['Column 1', 'Column 2', 'Column 3'],
                        ['Row 1 Data 1', 'Row 1 Data 2', 'Row 1 Data 3'],
                        ['Row 2 Data 1', 'Row 2 Data 2', 'Row 2 Data 3'],
                        ['Row 3 Data 1', 'Row 3 Data 2', 'Row 3 Data 3']
                    ];
                    
                    // Show preview
                    let tableHtml = '<table border="1" style="border-collapse: collapse; width: 100%;">';
                    extractedData.forEach(row => {
                        tableHtml += '<tr>';
                        row.forEach(cell => {
                            tableHtml += `<td style="padding: 8px; border: 1px solid #ddd;">${cell}</td>`;
                        });
                        tableHtml += '</tr>';
                    });
                    tableHtml += '</table>';
                    
                    previewContent.innerHTML = tableHtml;
                    pdfToExcelOptions.style.display = 'block';
                    pdfToExcelPreview.style.display = 'block';
                    convertBtn.style.display = 'block';
                    
                } catch (error) {
                    console.error('Error reading PDF:', error);
                    showStatus('Error reading PDF', 'error', 'pdf-to-excel-status-container');
                }
            }

            // Convert button
            convertBtn.addEventListener('click', convertToExcel);

            async function convertToExcel() {
                if (!selectedFile) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to Excel...', 'info', 'pdf-to-excel-status-container');

                try {
                    const format = document.getElementById('excel-format').value;
                    
                    if (format === 'xlsx') {
                        // Create XLSX file
                        const ws = XLSX.utils.aoa_to_sheet(extractedData);
                        const wb = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
                        const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
                        convertedBlob = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                    } else {
                        // Create CSV file
                        let csvContent = extractedData.map(row => row.join(',')).join('\n');
                        convertedBlob = new Blob([csvContent], { type: 'text/csv' });
                    }
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('PDF converted to Excel successfully!', 'success', 'pdf-to-excel-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to Excel', 'error', 'pdf-to-excel-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (convertedBlob) {
                    const format = document.getElementById('excel-format').value;
                    const extension = format === 'xlsx' ? '.xlsx' : '.csv';
                    const url = URL.createObjectURL(convertedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.pdf', extension);
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // PDF to PowerPoint Tool
        function loadPDFToPPTTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="pdf-to-ppt-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Select a PDF to convert to PowerPoint</div>
                    <input type="file" id="pdf-to-ppt-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="options-panel" id="pdf-to-ppt-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Slide Layout</span>
                        <div class="option-control">
                            <select id="slide-layout">
                                <option value="one-per-page">One PDF Page Per Slide</option>
                                <option value="two-per-page">Two PDF Pages Per Slide</option>
                                <option value="custom">Custom Layout</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Slide Size</span>
                        <div class="option-control">
                            <select id="slide-size">
                                <option value="widescreen">Widescreen (16:9)</option>
                                <option value="standard">Standard (4:3)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="pdf-to-ppt-preview" style="display: none;">
                    <h3>Conversion Preview</h3>
                    <div id="pdf-to-ppt-preview-content" style="max-height: 400px; overflow-y: auto; padding: 1rem; background: white; border-radius: 8px; text-align: center;">
                        <i class="fas fa-file-powerpoint" style="font-size: 4rem; color: #d24726; margin-bottom: 1rem;"></i>
                        <p>PDF will be converted to PowerPoint slides</p>
                    </div>
                </div>

                <div class="progress-container" id="pdf-to-ppt-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="pdf-to-ppt-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="pdf-to-ppt-progress-text">Converting to PowerPoint...</div>
                </div>

                <div id="pdf-to-ppt-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="pdf-to-ppt-convert-btn" style="display: none;">
                        <i class="fas fa-file-powerpoint"></i>
                        Convert to PowerPoint
                    </button>
                    <button class="btn btn-success btn-block" id="pdf-to-ppt-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download PowerPoint
                    </button>
                </div>
            `;

            setupPDFToPPTTool();
        }

        function setupPDFToPPTTool() {
            const uploadArea = document.getElementById('pdf-to-ppt-upload-area');
            const fileInput = document.getElementById('pdf-to-ppt-file-input');
            const pdfToPPTOptions = document.getElementById('pdf-to-ppt-options');
            const pdfToPPTPreview = document.getElementById('pdf-to-ppt-preview');
            const convertBtn = document.getElementById('pdf-to-ppt-convert-btn');
            const downloadBtn = document.getElementById('pdf-to-ppt-download-btn');
            const progressContainer = document.getElementById('pdf-to-ppt-progress-container');
            const progressFill = document.getElementById('pdf-to-ppt-progress-fill');
            const progressText = document.getElementById('pdf-to-ppt-progress-text');
            const statusContainer = document.getElementById('pdf-to-ppt-status-container');

            let selectedFile = null;
            let convertedBlob = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            async function handleFile(file) {
                selectedFile = file;
                
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    pdfToPPTOptions.style.display = 'block';
                    pdfToPPTPreview.style.display = 'block';
                    convertBtn.style.display = 'block';
                    
                } catch (error) {
                    console.error('Error reading PDF:', error);
                    showStatus('Error reading PDF', 'error', 'pdf-to-ppt-status-container');
                }
            }

            // Convert button
            convertBtn.addEventListener('click', convertToPPT);

            async function convertToPPT() {
                if (!selectedFile) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to PowerPoint...', 'info', 'pdf-to-ppt-status-container');

                try {
                    const slideLayout = document.getElementById('slide-layout').value;
                    const slideSize = document.getElementById('slide-size').value;
                    
                    // Create a simple PPTX file (simulated)
                    const pptxContent = `
                        <html>
                        <head>
                            <meta charset="utf-8">
                            <title>Converted from PDF</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 40px; }
                                .slide { page-break-after: always; margin-bottom: 40px; }
                                h1 { color: #2c3e50; text-align: center; }
                            </style>
                        </head>
                        <body>
                            <div class="slide">
                                <h1>Slide 1</h1>
                                <p>Converted from: ${selectedFile.name}</p>
                                <p>Layout: ${slideLayout}</p>
                                <p>Size: ${slideSize}</p>
                            </div>
                            <div class="slide">
                                <h1>Slide 2</h1>
                                <p>PDF to PowerPoint conversion</p>
                            </div>
                        </body>
                        </html>
                    `;
                    
                    convertedBlob = new Blob([pptxContent], { type: 'application/vnd.openxmlformats-officedocument.presentationml.presentation' });
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('PDF converted to PowerPoint successfully!', 'success', 'pdf-to-ppt-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to PowerPoint', 'error', 'pdf-to-ppt-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (convertedBlob) {
                    const url = URL.createObjectURL(convertedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace('.pdf', '.pptx');
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Compress Image Tool
        function loadCompressImageTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="image-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">Click or drag images here</div>
                    <div class="upload-subtext">Supports JPG, PNG, WebP, GIF</div>
                    <input type="file" id="image-file-input" accept="image/*" multiple style="display: none;">
                </div>

                <div class="compression-controls" id="image-compression-controls" style="display: none;">
                    <div class="control-group">
                        <label class="control-label">Compression Settings</label>
                        <div class="slider-container">
                            <div class="slider-header">
                                <span class="slider-label">Quality</span>
                                <span class="slider-value" id="image-quality-value">80%</span>
                            </div>
                            <input type="range" class="slider" id="image-quality-slider" min="10" max="100" value="80">
                        </div>
                        <div class="slider-container">
                            <div class="slider-header">
                                <span class="slider-label">Target Size</span>
                                <span class="slider-value" id="image-target-value">500 KB</span>
                            </div>
                            <input type="range" class="slider" id="image-target-slider" min="50" max="5000" value="500" step="50">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Output Format</label>
                        <select id="output-format" style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 10px;">
                            <option value="jpeg">JPEG</option>
                            <option value="png">PNG</option>
                            <option value="webp">WebP</option>
                        </select>
                    </div>
                </div>

                <div class="preview-container" id="image-preview-container" style="display: none;">
                    <h3>Image Preview</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <h4>Original</h4>
                            <img id="original-preview" class="preview-image" alt="Original">
                            <p id="original-info"></p>
                        </div>
                        <div>
                            <h4>Compressed</h4>
                            <img id="compressed-preview" class="preview-image" alt="Compressed">
                            <p id="compressed-info"></p>
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="image-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="image-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="image-progress-text">Compressing images...</div>
                </div>

                <div id="image-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="image-compress-btn" style="display: none;">
                        <i class="fas fa-compress"></i>
                        Compress Images
                    </button>
                    <button class="btn btn-success btn-block" id="image-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Compressed Images
                    </button>
                </div>
            `;

            setupCompressImageTool();
        }

        function setupCompressImageTool() {
            const uploadArea = document.getElementById('image-upload-area');
            const fileInput = document.getElementById('image-file-input');
            const compressionControls = document.getElementById('image-compression-controls');
            const previewContainer = document.getElementById('image-preview-container');
            const compressBtn = document.getElementById('image-compress-btn');
            const downloadBtn = document.getElementById('image-download-btn');
            const progressContainer = document.getElementById('image-progress-container');
            const progressFill = document.getElementById('image-progress-fill');
            const progressText = document.getElementById('image-progress-text');
            const statusContainer = document.getElementById('image-status-container');

            // Sliders
            const qualitySlider = document.getElementById('image-quality-slider');
            const targetSlider = document.getElementById('image-target-slider');
            const qualityValue = document.getElementById('image-quality-value');
            const targetValue = document.getElementById('image-target-value');

            // Preview elements
            const originalPreview = document.getElementById('original-preview');
            const compressedPreview = document.getElementById('compressed-preview');
            const originalInfo = document.getElementById('original-info');
            const compressedInfo = document.getElementById('compressed-info');

            let selectedFiles = [];
            let compressedBlobs = [];

            // Update slider values
            qualitySlider.addEventListener('input', (e) => {
                qualityValue.textContent = e.target.value + '%';
                if (selectedFiles.length > 0) {
                    previewCompression();
                }
            });

            targetSlider.addEventListener('input', (e) => {
                targetValue.textContent = e.target.value + ' KB';
                if (selectedFiles.length > 0) {
                    previewCompression();
                }
            });

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                const imageFiles = files.filter(file => file.type.startsWith('image/'));
                selectedFiles = imageFiles.slice(0, 5); // Limit to 5 files
                
                if (selectedFiles.length > 0) {
                    compressionControls.style.display = 'grid';
                    previewContainer.style.display = 'block';
                    compressBtn.style.display = 'block';
                    
                    // Show original preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        originalPreview.src = e.target.result;
                        originalInfo.textContent = `Size: ${formatFileSize(selectedFiles[0].size)}`;
                        previewCompression();
                    };
                    reader.readAsDataURL(selectedFiles[0]);
                }
            }

            function previewCompression() {
                if (selectedFiles.length === 0) return;
                
                const file = selectedFiles[0];
                const quality = parseInt(qualitySlider.value) / 100;
                const outputFormat = document.getElementById('output-format').value;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        
                        canvas.toBlob((blob) => {
                            compressedPreview.src = URL.createObjectURL(blob);
                            compressedInfo.textContent = `Size: ${formatFileSize(blob.size)}`;
                        }, `image/${outputFormat}`, quality);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }

            // Compress button
            compressBtn.addEventListener('click', compressImages);

            async function compressImages() {
                if (selectedFiles.length === 0) return;

                compressBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Compressing images...', 'info', 'image-status-container');

                try {
                    const quality = parseInt(qualitySlider.value) / 100;
                    const outputFormat = document.getElementById('output-format').value;
                    compressedBlobs = [];

                    for (let i = 0; i < selectedFiles.length; i++) {
                        const file = selectedFiles[i];
                        const progress = ((i + 1) / selectedFiles.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing image ${i + 1} of ${selectedFiles.length}...`;
                        
                        const blob = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    canvas.width = img.width;
                                    canvas.height = img.height;
                                    const ctx = canvas.getContext('2d');
                                    ctx.drawImage(img, 0, 0);
                                    
                                    canvas.toBlob(resolve, `image/${outputFormat}`, quality);
                                };
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                        
                        compressedBlobs.push({
                            blob: blob,
                            name: file.name.replace(/\.[^/.]+$/, '') + '_compressed.' + outputFormat
                        });
                    }
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Compression complete!';
                    showStatus('Images compressed successfully!', 'success', 'image-status-container');
                    
                    downloadBtn.style.display = 'block';
                    compressBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Compression error:', error);
                    showStatus('Error compressing images', 'error', 'image-status-container');
                    compressBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                compressedBlobs.forEach(item => {
                    const url = URL.createObjectURL(item.blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = item.name;
                    a.click();
                    URL.revokeObjectURL(url);
                });
            });
        }

        // Resize Image Tool
        function loadResizeImageTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="resize-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">Click or drag images here</div>
                    <div class="upload-subtext">Select images to resize</div>
                    <input type="file" id="resize-file-input" accept="image/*" multiple style="display: none;">
                </div>

                <div class="options-panel" id="resize-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Resize Mode</span>
                        <div class="option-control">
                            <select id="resize-mode">
                                <option value="pixels">Pixels</option>
                                <option value="percentage">Percentage</option>
                                <option value="dimensions">Dimensions</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Width</span>
                        <div class="option-control">
                            <input type="number" id="resize-width" value="800" min="1" max="5000">
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Height</span>
                        <div class="option-control">
                            <input type="number" id="resize-height" value="600" min="1" max="5000">
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Maintain Aspect Ratio</span>
                        <div class="option-control">
                            <input type="checkbox" id="maintain-aspect" checked>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="resize-preview-container" style="display: none;">
                    <h3>Resize Preview</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <h4>Original</h4>
                            <img id="resize-original-preview" class="preview-image" alt="Original">
                            <p id="resize-original-info"></p>
                        </div>
                        <div>
                            <h4>Resized</h4>
                            <img id="resize-preview-image" class="preview-image" alt="Resized">
                            <p id="resize-preview-info"></p>
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="resize-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="resize-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="resize-progress-text">Resizing images...</div>
                </div>

                <div id="resize-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="resize-btn" style="display: none;">
                        <i class="fas fa-expand-arrows-alt"></i>
                        Resize Images
                    </button>
                    <button class="btn btn-success btn-block" id="resize-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Resized Images
                    </button>
                </div>
            `;

            setupResizeImageTool();
        }

        function setupResizeImageTool() {
            const uploadArea = document.getElementById('resize-upload-area');
            const fileInput = document.getElementById('resize-file-input');
            const resizeOptions = document.getElementById('resize-options');
            const previewContainer = document.getElementById('resize-preview-container');
            const resizeBtn = document.getElementById('resize-btn');
            const downloadBtn = document.getElementById('resize-download-btn');
            const progressContainer = document.getElementById('resize-progress-container');
            const progressFill = document.getElementById('resize-progress-fill');
            const progressText = document.getElementById('resize-progress-text');
            const statusContainer = document.getElementById('resize-status-container');
            const resizeMode = document.getElementById('resize-mode');
            const maintainAspect = document.getElementById('maintain-aspect');

            // Preview elements
            const originalPreview = document.getElementById('resize-original-preview');
            const previewImage = document.getElementById('resize-preview-image');
            const originalInfo = document.getElementById('resize-original-info');
            const previewInfo = document.getElementById('resize-preview-info');

            let selectedFiles = [];
            let resizedBlobs = [];
            let originalDimensions = {};

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                const imageFiles = files.filter(file => file.type.startsWith('image/'));
                selectedFiles = imageFiles.slice(0, 5);
                
                if (selectedFiles.length > 0) {
                    resizeOptions.style.display = 'block';
                    previewContainer.style.display = 'block';
                    resizeBtn.style.display = 'block';
                    
                    // Show original preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            originalPreview.src = e.target.result;
                            originalInfo.textContent = `Size: ${img.width}x${img.height}px`;
                            originalDimensions = { width: img.width, height: img.height };
                            previewResize();
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(selectedFiles[0]);
                }
            }

            resizeMode.addEventListener('change', previewResize);
            document.getElementById('resize-width').addEventListener('input', previewResize);
            document.getElementById('resize-height').addEventListener('input', previewResize);
            maintainAspect.addEventListener('change', previewResize);

            function previewResize() {
                if (selectedFiles.length === 0) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        let newWidth = parseInt(document.getElementById('resize-width').value);
                        let newHeight = parseInt(document.getElementById('resize-height').value);
                        
                        if (maintainAspect.checked) {
                            const aspectRatio = img.width / img.height;
                            if (resizeMode.value === 'pixels') {
                                newHeight = Math.round(newWidth / aspectRatio);
                            } else if (resizeMode.value === 'percentage') {
                                const percentage = newWidth / 100;
                                newWidth = Math.round(img.width * percentage);
                                newHeight = Math.round(img.height * percentage);
                            }
                        }
                        
                        canvas.width = newWidth;
                        canvas.height = newHeight;
                        ctx.drawImage(img, 0, 0, newWidth, newHeight);
                        
                        canvas.toBlob((blob) => {
                            previewImage.src = URL.createObjectURL(blob);
                            previewInfo.textContent = `Size: ${newWidth}x${newHeight}px`;
                        }, 'image/jpeg', 0.9);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(selectedFiles[0]);
            }

            // Resize button
            resizeBtn.addEventListener('click', resizeImages);

            async function resizeImages() {
                if (selectedFiles.length === 0) return;

                resizeBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Resizing images...', 'info', 'resize-status-container');

                try {
                    resizedBlobs = [];

                    for (let i = 0; i < selectedFiles.length; i++) {
                        const file = selectedFiles[i];
                        const progress = ((i + 1) / selectedFiles.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing image ${i + 1} of ${selectedFiles.length}...`;
                        
                        const blob = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    const ctx = canvas.getContext('2d');
                                    
                                    let newWidth = parseInt(document.getElementById('resize-width').value);
                                    let newHeight = parseInt(document.getElementById('resize-height').value);
                                    
                                    if (maintainAspect.checked) {
                                        const aspectRatio = img.width / img.height;
                                        if (resizeMode.value === 'pixels') {
                                            newHeight = Math.round(newWidth / aspectRatio);
                                        } else if (resizeMode.value === 'percentage') {
                                            const percentage = newWidth / 100;
                                            newWidth = Math.round(img.width * percentage);
                                            newHeight = Math.round(img.height * percentage);
                                        }
                                    }
                                    
                                    canvas.width = newWidth;
                                    canvas.height = newHeight;
                                    ctx.drawImage(img, 0, 0, newWidth, newHeight);
                                    
                                    canvas.toBlob(resolve, 'image/jpeg', 0.9);
                                };
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                        
                        resizedBlobs.push({
                            blob: blob,
                            name: file.name.replace(/\.[^/.]+$/, '') + '_resized.jpg'
                        });
                    }
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Resize complete!';
                    showStatus('Images resized successfully!', 'success', 'resize-status-container');
                    
                    downloadBtn.style.display = 'block';
                    resizeBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Resize error:', error);
                    showStatus('Error resizing images', 'error', 'resize-status-container');
                    resizeBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                resizedBlobs.forEach(item => {
                    const url = URL.createObjectURL(item.blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = item.name;
                    a.click();
                    URL.revokeObjectURL(url);
                });
            });
        }

        // Crop Image Tool
        function loadCropImageTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="crop-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">Click or drag image here</div>
                    <div class="upload-subtext">Select an image to crop</div>
                    <input type="file" id="crop-file-input" accept="image/*" style="display: none;">
                </div>

                <div class="options-panel" id="crop-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Crop Presets</span>
                        <div class="option-control">
                            <select id="crop-preset">
                                <option value="free">Free Form</option>
                                <option value="square">Square (1:1)</option>
                                <option value="4:3">4:3</option>
                                <option value="16:9">16:9</option>
                                <option value="3:2">3:2</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">X Position</span>
                        <div class="option-control">
                            <input type="number" id="crop-x" value="0" min="0">
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Y Position</span>
                        <div class="option-control">
                            <input type="number" id="crop-y" value="0" min="0">
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Width</span>
                        <div class="option-control">
                            <input type="number" id="crop-width" value="200" min="1">
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Height</span>
                        <div class="option-control">
                            <input type="number" id="crop-height" value="200" min="1">
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="crop-preview-container" style="display: none;">
                    <h3>Crop Preview</h3>
                    <div style="position: relative; display: inline-block;">
                        <canvas id="crop-canvas" style="border: 1px solid #ddd; max-width: 100%;"></canvas>
                        <div id="crop-overlay" style="position: absolute; border: 2px solid #4361ee; background: rgba(67, 97, 238, 0.2); pointer-events: none;"></div>
                    </div>
                </div>

                <div class="progress-container" id="crop-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="crop-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="crop-progress-text">Cropping image...</div>
                </div>

                <div id="crop-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="crop-btn" style="display: none;">
                        <i class="fas fa-crop"></i>
                        Crop Image
                    </button>
                    <button class="btn btn-success btn-block" id="crop-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Cropped Image
                    </button>
                </div>
            `;

            setupCropImageTool();
        }

        function setupCropImageTool() {
            const uploadArea = document.getElementById('crop-upload-area');
            const fileInput = document.getElementById('crop-file-input');
            const cropOptions = document.getElementById('crop-options');
            const previewContainer = document.getElementById('crop-preview-container');
            const cropBtn = document.getElementById('crop-btn');
            const downloadBtn = document.getElementById('crop-download-btn');
            const progressContainer = document.getElementById('crop-progress-container');
            const progressFill = document.getElementById('crop-progress-fill');
            const progressText = document.getElementById('crop-progress-text');
            const statusContainer = document.getElementById('crop-status-container');
            const canvas = document.getElementById('crop-canvas');
            const ctx = canvas.getContext('2d');
            const overlay = document.getElementById('crop-overlay');

            let selectedFile = null;
            let croppedBlob = null;
            let originalImage = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            function handleFile(file) {
                selectedFile = file;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        originalImage = img;
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        // Set initial crop values
                        document.getElementById('crop-width').value = Math.min(200, img.width);
                        document.getElementById('crop-height').value = Math.min(200, img.height);
                        document.getElementById('crop-width').max = img.width;
                        document.getElementById('crop-height').max = img.height;
                        document.getElementById('crop-x').max = img.width - 1;
                        document.getElementById('crop-y').max = img.height - 1;
                        
                        updateCropOverlay();
                        
                        cropOptions.style.display = 'block';
                        previewContainer.style.display = 'block';
                        cropBtn.style.display = 'block';
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }

            // Update crop overlay
            document.getElementById('crop-preset').addEventListener('change', (e) => {
                if (!originalImage) return;
                
                const preset = e.target.value;
                const imgWidth = originalImage.width;
                const imgHeight = originalImage.height;
                
                switch(preset) {
                    case 'square':
                        const size = Math.min(imgWidth, imgHeight);
                        document.getElementById('crop-width').value = size;
                        document.getElementById('crop-height').value = size;
                        break;
                    case '4:3':
                        document.getElementById('crop-width').value = Math.min(400, imgWidth);
                        document.getElementById('crop-height').value = Math.min(300, imgHeight);
                        break;
                    case '16:9':
                        document.getElementById('crop-width').value = Math.min(400, imgWidth);
                        document.getElementById('crop-height').value = Math.min(225, imgHeight);
                        break;
                    case '3:2':
                        document.getElementById('crop-width').value = Math.min(300, imgWidth);
                        document.getElementById('crop-height').value = Math.min(200, imgHeight);
                        break;
                }
                
                updateCropOverlay();
            });

            ['crop-x', 'crop-y', 'crop-width', 'crop-height'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateCropOverlay);
            });

            function updateCropOverlay() {
                if (!originalImage) return;
                
                const x = parseInt(document.getElementById('crop-x').value);
                const y = parseInt(document.getElementById('crop-y').value);
                const width = parseInt(document.getElementById('crop-width').value);
                const height = parseInt(document.getElementById('crop-height').value);
                
                const scaleX = canvas.width / originalImage.width;
                const scaleY = canvas.height / originalImage.height;
                
                overlay.style.left = (x * scaleX) + 'px';
                overlay.style.top = (y * scaleY) + 'px';
                overlay.style.width = (width * scaleX) + 'px';
                overlay.style.height = (height * scaleY) + 'px';
            }

            // Crop button
            cropBtn.addEventListener('click', cropImage);

            async function cropImage() {
                if (!selectedFile || !originalImage) return;

                cropBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Cropping image...', 'info', 'crop-status-container');

                try {
                    const x = parseInt(document.getElementById('crop-x').value);
                    const y = parseInt(document.getElementById('crop-y').value);
                    const width = parseInt(document.getElementById('crop-width').value);
                    const height = parseInt(document.getElementById('crop-height').value);
                    
                    const cropCanvas = document.createElement('canvas');
                    const cropCtx = cropCanvas.getContext('2d');
                    cropCanvas.width = width;
                    cropCanvas.height = height;
                    
                    cropCtx.drawImage(originalImage, x, y, width, height, 0, 0, width, height);
                    
                    croppedBlob = await new Promise((resolve) => {
                        cropCanvas.toBlob(resolve, 'image/jpeg', 0.9);
                    });
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Crop complete!';
                    showStatus('Image cropped successfully!', 'success', 'crop-status-container');
                    
                    downloadBtn.style.display = 'block';
                    cropBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Crop error:', error);
                    showStatus('Error cropping image', 'error', 'crop-status-container');
                    cropBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (croppedBlob) {
                    const url = URL.createObjectURL(croppedBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace(/\.[^/.]+$/, '') + '_cropped.jpg';
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Rotate Image Tool
        function loadRotateImageTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="rotate-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">Click or drag image here</div>
                    <div class="upload-subtext">Select an image to rotate</div>
                    <input type="file" id="rotate-file-input" accept="image/*" multiple style="display: none;">
                </div>

                <div class="options-panel" id="rotate-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Rotation Angle</span>
                        <div class="option-control">
                            <select id="rotation-angle">
                                <option value="90">90 clockwise</option>
                                <option value="180">180</option>
                                <option value="270">90 counter-clockwise</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row" id="custom-angle-row" style="display: none;">
                        <span class="option-label">Custom Angle</span>
                        <div class="option-control">
                            <input type="range" id="custom-angle" min="0" max="360" value="0">
                            <span id="angle-value">0</span>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Flip</span>
                        <div class="option-control">
                            <button class="btn btn-primary" id="flip-horizontal">
                                <i class="fas fa-arrows-alt-h"></i>
                                Flip Horizontal
                            </button>
                            <button class="btn btn-primary" id="flip-vertical">
                                <i class="fas fa-arrows-alt-v"></i>
                                Flip Vertical
                            </button>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="rotate-preview-container" style="display: none;">
                    <h3>Rotation Preview</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <h4>Original</h4>
                            <img id="rotate-original-preview" class="preview-image" alt="Original">
                        </div>
                        <div>
                            <h4>Rotated</h4>
                            <canvas id="rotate-preview-canvas" class="preview-image" alt="Rotated"></canvas>
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="rotate-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="rotate-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="rotate-progress-text">Rotating images...</div>
                </div>

                <div id="rotate-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="rotate-btn" style="display: none;">
                        <i class="fas fa-redo"></i>
                        Rotate Images
                    </button>
                    <button class="btn btn-success btn-block" id="rotate-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Rotated Images
                    </button>
                </div>
            `;

            setupRotateImageTool();
        }

        function setupRotateImageTool() {
            const uploadArea = document.getElementById('rotate-upload-area');
            const fileInput = document.getElementById('rotate-file-input');
            const rotateOptions = document.getElementById('rotate-options');
            const previewContainer = document.getElementById('rotate-preview-container');
            const rotateBtn = document.getElementById('rotate-btn');
            const downloadBtn = document.getElementById('rotate-download-btn');
            const progressContainer = document.getElementById('rotate-progress-container');
            const progressFill = document.getElementById('rotate-progress-fill');
            const progressText = document.getElementById('rotate-progress-text');
            const statusContainer = document.getElementById('rotate-status-container');
            const rotationAngle = document.getElementById('rotation-angle');
            const customAngleRow = document.getElementById('custom-angle-row');
            const customAngle = document.getElementById('custom-angle');
            const angleValue = document.getElementById('angle-value');
            const previewCanvas = document.getElementById('rotate-preview-canvas');
            const previewCtx = previewCanvas.getContext('2d');

            let selectedFiles = [];
            let rotatedBlobs = [];
            let currentRotation = 0;
            let flipH = false;
            let flipV = false;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                const imageFiles = files.filter(file => file.type.startsWith('image/'));
                selectedFiles = imageFiles.slice(0, 5);
                
                if (selectedFiles.length > 0) {
                    rotateOptions.style.display = 'block';
                    previewContainer.style.display = 'block';
                    rotateBtn.style.display = 'block';
                    
                    // Show original preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('rotate-original-preview').src = e.target.result;
                        previewRotation();
                    };
                    reader.readAsDataURL(selectedFiles[0]);
                }
            }

            rotationAngle.addEventListener('change', (e) => {
                if (e.target.value === 'custom') {
                    customAngleRow.style.display = 'flex';
                } else {
                    customAngleRow.style.display = 'none';
                    currentRotation = parseInt(e.target.value);
                }
                previewRotation();
            });

            customAngle.addEventListener('input', (e) => {
                currentRotation = parseInt(e.target.value);
                angleValue.textContent = currentRotation + '';
                previewRotation();
            });

            document.getElementById('flip-horizontal').addEventListener('click', () => {
                flipH = !flipH;
                previewRotation();
            });

            document.getElementById('flip-vertical').addEventListener('click', () => {
                flipV = !flipV;
                previewRotation();
            });

            function previewRotation() {
                if (selectedFiles.length === 0) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const angle = rotationAngle.value === 'custom' ? currentRotation : parseInt(rotationAngle.value);
                        const radians = (angle * Math.PI) / 180;
                        
                        if (angle % 180 === 90) {
                            previewCanvas.width = img.height;
                            previewCanvas.height = img.width;
                        } else {
                            previewCanvas.width = img.width;
                            previewCanvas.height = img.height;
                        }
                        
                        previewCtx.save();
                        previewCtx.translate(previewCanvas.width / 2, previewCanvas.height / 2);
                        previewCtx.rotate(radians);
                        
                        if (flipH) {
                            previewCtx.scale(-1, 1);
                        }
                        if (flipV) {
                            previewCtx.scale(1, -1);
                        }
                        
                        previewCtx.drawImage(img, -img.width / 2, -img.height / 2);
                        previewCtx.restore();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(selectedFiles[0]);
            }

            // Rotate button
            rotateBtn.addEventListener('click', rotateImages);

            async function rotateImages() {
                if (selectedFiles.length === 0) return;

                rotateBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Rotating images...', 'info', 'rotate-status-container');

                try {
                    rotatedBlobs = [];

                    for (let i = 0; i < selectedFiles.length; i++) {
                        const file = selectedFiles[i];
                        const progress = ((i + 1) / selectedFiles.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing image ${i + 1} of ${selectedFiles.length}...`;
                        
                        const blob = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    const ctx = canvas.getContext('2d');
                                    
                                    const angle = rotationAngle.value === 'custom' ? currentRotation : parseInt(rotationAngle.value);
                                    const radians = (angle * Math.PI) / 180;
                                    
                                    if (angle % 180 === 90) {
                                        canvas.width = img.height;
                                        canvas.height = img.width;
                                    } else {
                                        canvas.width = img.width;
                                        canvas.height = img.height;
                                    }
                                    
                                    ctx.save();
                                    ctx.translate(canvas.width / 2, canvas.height / 2);
                                    ctx.rotate(radians);
                                    
                                    if (flipH) {
                                        ctx.scale(-1, 1);
                                    }
                                    if (flipV) {
                                        ctx.scale(1, -1);
                                    }
                                    
                                    ctx.drawImage(img, -img.width / 2, -img.height / 2);
                                    ctx.restore();
                                    
                                    canvas.toBlob(resolve, 'image/jpeg', 0.9);
                                };
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                        
                        rotatedBlobs.push({
                            blob: blob,
                            name: file.name.replace(/\.[^/.]+$/, '') + '_rotated.jpg'
                        });
                    }
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Rotation complete!';
                    showStatus('Images rotated successfully!', 'success', 'rotate-status-container');
                    
                    downloadBtn.style.display = 'block';
                    rotateBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Rotation error:', error);
                    showStatus('Error rotating images', 'error', 'rotate-status-container');
                    rotateBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                rotatedBlobs.forEach(item => {
                    const url = URL.createObjectURL(item.blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = item.name;
                    a.click();
                    URL.revokeObjectURL(url);
                });
            });
        }

        // Convert Image Tool
        function loadConvertImageTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="convert-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">Click or drag images here</div>
                    <div class="upload-subtext">Select images to convert format</div>
                    <input type="file" id="convert-file-input" accept="image/*" multiple style="display: none;">
                </div>

                <div class="options-panel" id="convert-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Output Format</span>
                        <div class="option-control">
                            <select id="output-image-format">
                                <option value="jpeg">JPEG</option>
                                <option value="png">PNG</option>
                                <option value="webp">WebP</option>
                                <option value="bmp">BMP</option>
                                <option value="gif">GIF</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Quality</span>
                        <div class="option-control">
                            <input type="range" id="convert-quality" min="10" max="100" value="90">
                            <span id="convert-quality-value">90%</span>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Resize</span>
                        <div class="option-control">
                            <select id="convert-resize">
                                <option value="none">No Resize</option>
                                <option value="50">50%</option>
                                <option value="75">75%</option>
                                <option value="125">125%</option>
                                <option value="150">150%</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="convert-preview-container" style="display: none;">
                    <h3>Conversion Preview</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <h4>Original</h4>
                            <img id="convert-original-preview" class="preview-image" alt="Original">
                            <p id="convert-original-info"></p>
                        </div>
                        <div>
                            <h4>Converted</h4>
                            <img id="convert-preview-image" class="preview-image" alt="Converted">
                            <p id="convert-preview-info"></p>
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="convert-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="convert-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="convert-progress-text">Converting images...</div>
                </div>

                <div id="convert-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="convert-btn" style="display: none;">
                        <i class="fas fa-exchange-alt"></i>
                        Convert Images
                    </button>
                    <button class="btn btn-success btn-block" id="convert-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Converted Images
                    </button>
                </div>
            `;

            setupConvertImageTool();
        }

        function setupConvertImageTool() {
            const uploadArea = document.getElementById('convert-upload-area');
            const fileInput = document.getElementById('convert-file-input');
            const convertOptions = document.getElementById('convert-options');
            const previewContainer = document.getElementById('convert-preview-container');
            const convertBtn = document.getElementById('convert-btn');
            const downloadBtn = document.getElementById('convert-download-btn');
            const progressContainer = document.getElementById('convert-progress-container');
            const progressFill = document.getElementById('convert-progress-fill');
            const progressText = document.getElementById('convert-progress-text');
            const statusContainer = document.getElementById('convert-status-container');
            const outputFormat = document.getElementById('output-image-format');
            const qualitySlider = document.getElementById('convert-quality');
            const qualityValue = document.getElementById('convert-quality-value');
            const resizeSelect = document.getElementById('convert-resize');

            // Preview elements
            const originalPreview = document.getElementById('convert-original-preview');
            const previewImage = document.getElementById('convert-preview-image');
            const originalInfo = document.getElementById('convert-original-info');
            const previewInfo = document.getElementById('convert-preview-info');

            let selectedFiles = [];
            let convertedBlobs = [];

            // Update quality value
            qualitySlider.addEventListener('input', (e) => {
                qualityValue.textContent = e.target.value + '%';
                if (selectedFiles.length > 0) {
                    previewConversion();
                }
            });

            outputFormat.addEventListener('change', previewConversion);
            resizeSelect.addEventListener('change', previewConversion);

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                const imageFiles = files.filter(file => file.type.startsWith('image/'));
                selectedFiles = imageFiles.slice(0, 5);
                
                if (selectedFiles.length > 0) {
                    convertOptions.style.display = 'block';
                    previewContainer.style.display = 'block';
                    convertBtn.style.display = 'block';
                    
                    // Show original preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        originalPreview.src = e.target.result;
                        originalInfo.textContent = `Format: ${selectedFiles[0].type.split('/')[1].toUpperCase()}`;
                        previewConversion();
                    };
                    reader.readAsDataURL(selectedFiles[0]);
                }
            }

            function previewConversion() {
                if (selectedFiles.length === 0) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        let newWidth = img.width;
                        let newHeight = img.height;
                        
                        const resize = resizeSelect.value;
                        if (resize !== 'none') {
                            const scale = parseInt(resize) / 100;
                            newWidth = Math.round(img.width * scale);
                            newHeight = Math.round(img.height * scale);
                        }
                        
                        canvas.width = newWidth;
                        canvas.height = newHeight;
                        ctx.drawImage(img, 0, 0, newWidth, newHeight);
                        
                        const format = outputFormat.value;
                        const quality = parseInt(qualitySlider.value) / 100;
                        const mimeType = format === 'jpg' ? 'image/jpeg' : `image/${format}`;
                        
                        canvas.toBlob((blob) => {
                            previewImage.src = URL.createObjectURL(blob);
                            previewInfo.textContent = `Format: ${format.toUpperCase()}`;
                        }, mimeType, quality);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(selectedFiles[0]);
            }

            // Convert button
            convertBtn.addEventListener('click', convertImages);

            async function convertImages() {
                if (selectedFiles.length === 0) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting images...', 'info', 'convert-status-container');

                try {
                    const format = outputFormat.value;
                    const quality = parseInt(qualitySlider.value) / 100;
                    const resize = resizeSelect.value;
                    convertedBlobs = [];

                    for (let i = 0; i < selectedFiles.length; i++) {
                        const file = selectedFiles[i];
                        const progress = ((i + 1) / selectedFiles.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing image ${i + 1} of ${selectedFiles.length}...`;
                        
                        const blob = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    const ctx = canvas.getContext('2d');
                                    
                                    let newWidth = img.width;
                                    let newHeight = img.height;
                                    
                                    if (resize !== 'none') {
                                        const scale = parseInt(resize) / 100;
                                        newWidth = Math.round(img.width * scale);
                                        newHeight = Math.round(img.height * scale);
                                    }
                                    
                                    canvas.width = newWidth;
                                    canvas.height = newHeight;
                                    ctx.drawImage(img, 0, 0, newWidth, newHeight);
                                    
                                    const mimeType = format === 'jpg' ? 'image/jpeg' : `image/${format}`;
                                    canvas.toBlob(resolve, mimeType, quality);
                                };
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                        
                        const extension = format === 'jpg' ? 'jpg' : format;
                        convertedBlobs.push({
                            blob: blob,
                            name: file.name.replace(/\.[^/.]+$/, '') + '_converted.' + extension
                        });
                    }
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('Images converted successfully!', 'success', 'convert-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting images', 'error', 'convert-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                convertedBlobs.forEach(item => {
                    const url = URL.createObjectURL(item.blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = item.name;
                    a.click();
                    URL.revokeObjectURL(url);
                });
            });
        }

        // Add Image Watermark Tool
        function loadAddImageWatermarkTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="watermark-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">Click or drag images here</div>
                    <div class="upload-subtext">Select images to add watermark</div>
                    <input type="file" id="watermark-file-input" accept="image/*" multiple style="display: none;">
                </div>

                <div class="options-panel" id="watermark-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Watermark Type</span>
                        <div class="option-control">
                            <select id="watermark-type">
                                <option value="text">Text</option>
                                <option value="image">Image</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row" id="watermark-text-row">
                        <span class="option-label">Watermark Text</span>
                        <div class="option-control">
                            <input type="text" id="watermark-text-input" placeholder="Enter watermark text" value="WATERMARK">
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Position</span>
                        <div class="option-control">
                            <select id="watermark-position">
                                <option value="center">Center</option>
                                <option value="top-left">Top Left</option>
                                <option value="top-right">Top Right</option>
                                <option value="bottom-left">Bottom Left</option>
                                <option value="bottom-right">Bottom Right</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Opacity</span>
                        <div class="option-control">
                            <input type="range" id="watermark-opacity" min="0" max="100" value="50">
                            <span id="watermark-opacity-value">50%</span>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Size</span>
                        <div class="option-control">
                            <input type="range" id="watermark-size" min="10" max="200" value="50">
                            <span id="watermark-size-value">50px</span>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="watermark-preview-container" style="display: none;">
                    <h3>Watermark Preview</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <h4>Original</h4>
                            <img id="watermark-original-preview" class="preview-image" alt="Original">
                        </div>
                        <div>
                            <h4>With Watermark</h4>
                            <canvas id="watermark-preview-canvas" class="preview-image" alt="With Watermark"></canvas>
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="watermark-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="watermark-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="watermark-progress-text">Adding watermark...</div>
                </div>

                <div id="watermark-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="watermark-add-btn" style="display: none;">
                        <i class="fas fa-stamp"></i>
                        Add Watermark
                    </button>
                    <button class="btn btn-success btn-block" id="watermark-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download Watermarked Images
                    </button>
                </div>
            `;

            setupAddImageWatermarkTool();
        }

        function setupAddImageWatermarkTool() {
            const uploadArea = document.getElementById('watermark-upload-area');
            const fileInput = document.getElementById('watermark-file-input');
            const watermarkOptions = document.getElementById('watermark-options');
            const previewContainer = document.getElementById('watermark-preview-container');
            const watermarkBtn = document.getElementById('watermark-add-btn');
            const downloadBtn = document.getElementById('watermark-download-btn');
            const progressContainer = document.getElementById('watermark-progress-container');
            const progressFill = document.getElementById('watermark-progress-fill');
            const progressText = document.getElementById('watermark-progress-text');
            const statusContainer = document.getElementById('watermark-status-container');
            const watermarkType = document.getElementById('watermark-type');
            const watermarkTextRow = document.getElementById('watermark-text-row');
            const opacitySlider = document.getElementById('watermark-opacity');
            const opacityValue = document.getElementById('watermark-opacity-value');
            const sizeSlider = document.getElementById('watermark-size');
            const sizeValue = document.getElementById('watermark-size-value');
            const previewCanvas = document.getElementById('watermark-preview-canvas');
            const previewCtx = previewCanvas.getContext('2d');

            let selectedFiles = [];
            let watermarkedBlobs = [];

            // Update slider values
            opacitySlider.addEventListener('input', (e) => {
                opacityValue.textContent = e.target.value + '%';
                if (selectedFiles.length > 0) {
                    previewWatermark();
                }
            });

            sizeSlider.addEventListener('input', (e) => {
                sizeValue.textContent = e.target.value + 'px';
                if (selectedFiles.length > 0) {
                    previewWatermark();
                }
            });

            watermarkType.addEventListener('change', (e) => {
                watermarkTextRow.style.display = e.target.value === 'text' ? 'flex' : 'none';
                if (selectedFiles.length > 0) {
                    previewWatermark();
                }
            });

            ['watermark-text-input', 'watermark-position'].forEach(id => {
                document.getElementById(id).addEventListener('change', previewWatermark);
            });

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                const imageFiles = files.filter(file => file.type.startsWith('image/'));
                selectedFiles = imageFiles.slice(0, 5);
                
                if (selectedFiles.length > 0) {
                    watermarkOptions.style.display = 'block';
                    previewContainer.style.display = 'block';
                    watermarkBtn.style.display = 'block';
                    
                    // Show original preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('watermark-original-preview').src = e.target.result;
                        previewWatermark();
                    };
                    reader.readAsDataURL(selectedFiles[0]);
                }
            }

            function previewWatermark() {
                if (selectedFiles.length === 0) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        previewCanvas.width = img.width;
                        previewCanvas.height = img.height;
                        previewCtx.drawImage(img, 0, 0);
                        
                        const type = watermarkType.value;
                        const text = document.getElementById('watermark-text-input').value;
                        const position = document.getElementById('watermark-position').value;
                        const opacity = parseInt(opacitySlider.value) / 100;
                        const size = parseInt(sizeSlider.value);
                        
                        previewCtx.save();
                        previewCtx.globalAlpha = opacity;
                        previewCtx.font = `${size}px Arial`;
                        previewCtx.fillStyle = 'white';
                        previewCtx.strokeStyle = 'black';
                        previewCtx.lineWidth = 2;
                        
                        let x = previewCanvas.width / 2;
                        let y = previewCanvas.height / 2;
                        
                        switch(position) {
                            case 'top-left':
                                x = 50;
                                y = 50;
                                break;
                            case 'top-right':
                                x = previewCanvas.width - 50;
                                y = 50;
                                break;
                            case 'bottom-left':
                                x = 50;
                                y = previewCanvas.height - 50;
                                break;
                            case 'bottom-right':
                                x = previewCanvas.width - 50;
                                y = previewCanvas.height - 50;
                                break;
                        }
                        
                        previewCtx.translate(x, y);
                        previewCtx.rotate(-Math.PI / 6);
                        previewCtx.strokeText(text, 0, 0);
                        previewCtx.fillText(text, 0, 0);
                        previewCtx.restore();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(selectedFiles[0]);
            }

            // Add watermark button
            watermarkBtn.addEventListener('click', addWatermark);

            async function addWatermark() {
                if (selectedFiles.length === 0) return;

                watermarkBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Adding watermark...', 'info', 'watermark-status-container');

                try {
                    const type = watermarkType.value;
                    const text = document.getElementById('watermark-text-input').value;
                    const position = document.getElementById('watermark-position').value;
                    const opacity = parseInt(opacitySlider.value) / 100;
                    const size = parseInt(sizeSlider.value);
                    watermarkedBlobs = [];

                    for (let i = 0; i < selectedFiles.length; i++) {
                        const file = selectedFiles[i];
                        const progress = ((i + 1) / selectedFiles.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing image ${i + 1} of ${selectedFiles.length}...`;
                        
                        const blob = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    const ctx = canvas.getContext('2d');
                                    canvas.width = img.width;
                                    canvas.height = img.height;
                                    ctx.drawImage(img, 0, 0);
                                    
                                    ctx.save();
                                    ctx.globalAlpha = opacity;
                                    ctx.font = `${size}px Arial`;
                                    ctx.fillStyle = 'white';
                                    ctx.strokeStyle = 'black';
                                    ctx.lineWidth = 2;
                                    
                                    let x = canvas.width / 2;
                                    let y = canvas.height / 2;
                                    
                                    switch(position) {
                                        case 'top-left':
                                            x = 50;
                                            y = 50;
                                            break;
                                        case 'top-right':
                                            x = canvas.width - 50;
                                            y = 50;
                                            break;
                                        case 'bottom-left':
                                            x = 50;
                                            y = canvas.height - 50;
                                            break;
                                        case 'bottom-right':
                                            x = canvas.width - 50;
                                            y = canvas.height - 50;
                                            break;
                                    }
                                    
                                    ctx.translate(x, y);
                                    ctx.rotate(-Math.PI / 6);
                                    ctx.strokeText(text, 0, 0);
                                    ctx.fillText(text, 0, 0);
                                    ctx.restore();
                                    
                                    canvas.toBlob(resolve, 'image/jpeg', 0.9);
                                };
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                        
                        watermarkedBlobs.push({
                            blob: blob,
                            name: file.name.replace(/\.[^/.]+$/, '') + '_watermarked.jpg'
                        });
                    }
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Watermark added!';
                    showStatus('Watermark added successfully!', 'success', 'watermark-status-container');
                    
                    downloadBtn.style.display = 'block';
                    watermarkBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Watermark error:', error);
                    showStatus('Error adding watermark', 'error', 'watermark-status-container');
                    watermarkBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                watermarkedBlobs.forEach(item => {
                    const url = URL.createObjectURL(item.blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = item.name;
                    a.click();
                    URL.revokeObjectURL(url);
                });
            });
        }

        // Images to PDF Tool
        function loadImagesToPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="images-to-pdf-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">Click or drag images here</div>
                    <div class="upload-subtext">Select multiple images to convert to PDF</div>
                    <input type="file" id="images-to-pdf-file-input" accept="image/*" multiple style="display: none;">
                </div>

                <div class="file-list" id="images-to-pdf-file-list" style="display: none;">
                    <!-- Files will be listed here -->
                </div>

                <div class="options-panel" id="images-to-pdf-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Page Size</span>
                        <div class="option-control">
                            <select id="pdf-page-size">
                                <option value="a4">A4</option>
                                <option value="letter">Letter</option>
                                <option value="legal">Legal</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Orientation</span>
                        <div class="option-control">
                            <select id="pdf-page-orientation">
                                <option value="portrait">Portrait</option>
                                <option value="landscape">Landscape</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Image Layout</span>
                        <div class="option-control">
                            <select id="image-layout">
                                <option value="one-per-page">One Image Per Page</option>
                                <option value="fit-to-page">Fit to Page</option>
                                <option value="grid">Grid Layout</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Margin</span>
                        <div class="option-control">
                            <input type="number" id="pdf-margin" min="0" max="50" value="10">
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="images-to-pdf-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="images-to-pdf-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="images-to-pdf-progress-text">Converting to PDF...</div>
                </div>

                <div id="images-to-pdf-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="images-to-pdf-btn" style="display: none;">
                        <i class="fas fa-file-pdf"></i>
                        Convert to PDF
                    </button>
                    <button class="btn btn-success btn-block" id="images-to-pdf-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download PDF
                    </button>
                </div>
            `;

            setupImagesToPDFTool();
        }

        function setupImagesToPDFTool() {
            const uploadArea = document.getElementById('images-to-pdf-upload-area');
            const fileInput = document.getElementById('images-to-pdf-file-input');
            const fileList = document.getElementById('images-to-pdf-file-list');
            const pdfOptions = document.getElementById('images-to-pdf-options');
            const convertBtn = document.getElementById('images-to-pdf-btn');
            const downloadBtn = document.getElementById('images-to-pdf-download-btn');
            const progressContainer = document.getElementById('images-to-pdf-progress-container');
            const progressFill = document.getElementById('images-to-pdf-progress-fill');
            const progressText = document.getElementById('images-to-pdf-progress-text');
            const statusContainer = document.getElementById('images-to-pdf-status-container');

            let imageFiles = [];
            let pdfBlob = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                const imageFileList = files.filter(file => file.type.startsWith('image/'));
                imageFiles.push(...imageFileList);
                updateFileList();
            }

            function updateFileList() {
                fileList.innerHTML = '';
                
                if (imageFiles.length === 0) {
                    fileList.style.display = 'none';
                    pdfOptions.style.display = 'none';
                    convertBtn.style.display = 'none';
                    return;
                }
                
                fileList.style.display = 'block';
                pdfOptions.style.display = 'block';
                convertBtn.style.display = 'block';
                
                imageFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    fileItem.innerHTML = `
                        <div class="file-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="file-details">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                        </div>
                        <button class="file-remove" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    fileList.appendChild(fileItem);
                });
                
                document.querySelectorAll('.file-remove').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index);
                        imageFiles.splice(index, 1);
                        updateFileList();
                    });
                });
            }

            // Convert button
            convertBtn.addEventListener('click', convertToPDF);

            async function convertToPDF() {
                if (imageFiles.length === 0) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to PDF...', 'info', 'images-to-pdf-status-container');

                try {
                    const { jsPDF } = window.jspdf;
                    const pageSize = document.getElementById('pdf-page-size').value;
                    const orientation = document.getElementById('pdf-page-orientation').value;
                    const imageLayout = document.getElementById('image-layout').value;
                    const margin = parseInt(document.getElementById('pdf-margin').value);
                    
                    let pageWidth, pageHeight;
                    switch(pageSize) {
                        case 'a4':
                            pageWidth = orientation === 'portrait' ? 210 : 297;
                            pageHeight = orientation === 'portrait' ? 297 : 210;
                            break;
                        case 'letter':
                            pageWidth = orientation === 'portrait' ? 216 : 279;
                            pageHeight = orientation === 'portrait' ? 279 : 216;
                            break;
                        case 'legal':
                            pageWidth = orientation === 'portrait' ? 216 : 356;
                            pageHeight = orientation === 'portrait' ? 356 : 216;
                            break;
                    }
                    
                    const doc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    const usableWidth = pageWidth - (margin * 2);
                    const usableHeight = pageHeight - (margin * 2);
                    
                    for (let i = 0; i < imageFiles.length; i++) {
                        const progress = ((i + 1) / imageFiles.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing image ${i + 1} of ${imageFiles.length}...`;
                        
                        if (i > 0) {
                            doc.addPage([pageWidth, pageHeight], orientation);
                        }
                        
                        const file = imageFiles[i];
                        
                        const img = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => resolve(img);
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                        
                        let imgWidth, imgHeight;
                        
                        if (imageLayout === 'fit-to-page') {
                            imgWidth = usableWidth;
                            imgHeight = usableHeight;
                        } else {
                            const aspectRatio = img.width / img.height;
                            imgWidth = Math.min(usableWidth, usableHeight * aspectRatio);
                            imgHeight = imgWidth / aspectRatio;
                        }
                        
                        const x = margin + (usableWidth - imgWidth) / 2;
                        const y = margin + (usableHeight - imgHeight) / 2;
                        
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        const imgData = canvas.toDataURL('image/jpeg', 0.9);
                        doc.addImage(imgData, 'JPEG', x, y, imgWidth, imgHeight);
                    }
                    
                    pdfBlob = doc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('Images converted to PDF successfully!', 'success', 'images-to-pdf-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to PDF', 'error', 'images-to-pdf-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (pdfBlob) {
                    const url = URL.createObjectURL(pdfBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'converted.pdf';
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // PDF to JPG Tool
        function loadPDFToJPGTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="pdf-to-jpg-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Select a PDF to convert to JPEG</div>
                    <input type="file" id="pdf-to-jpg-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="options-panel" id="pdf-to-jpg-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Image Quality</span>
                        <div class="option-control">
                            <select id="jpg-quality">
                                <option value="high">High (90%)</option>
                                <option value="medium" selected>Medium (70%)</option>
                                <option value="low">Low (50%)</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">DPI</span>
                        <div class="option-control">
                            <select id="jpg-dpi">
                                <option value="150">150 DPI</option>
                                <option value="300" selected>300 DPI</option>
                                <option value="600">600 DPI</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Pages</span>
                        <div class="option-control">
                            <select id="jpg-pages">
                                <option value="all">All Pages</option>
                                <option value="first">First Page Only</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="pdf-to-jpg-preview" style="display: none;">
                    <h3>Conversion Preview</h3>
                    <div id="pdf-to-jpg-preview-content" style="max-height: 400px; overflow-y: auto; padding: 1rem; background: white; border-radius: 8px;">
                        <!-- Preview content will be here -->
                    </div>
                </div>

                <div class="progress-container" id="pdf-to-jpg-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="pdf-to-jpg-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="pdf-to-jpg-progress-text">Converting to JPEG...</div>
                </div>

                <div id="pdf-to-jpg-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="pdf-to-jpg-convert-btn" style="display: none;">
                        <i class="fas fa-file-image"></i>
                        Convert to JPEG
                    </button>
                    <button class="btn btn-success btn-block" id="pdf-to-jpg-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download JPEG Images
                    </button>
                </div>
            `;

            setupPDFToJPGTool();
        }

        function setupPDFToJPGTool() {
            const uploadArea = document.getElementById('pdf-to-jpg-upload-area');
            const fileInput = document.getElementById('pdf-to-jpg-file-input');
            const pdfToJPGOptions = document.getElementById('pdf-to-jpg-options');
            const previewContainer = document.getElementById('pdf-to-jpg-preview');
            const previewContent = document.getElementById('pdf-to-jpg-preview-content');
            const convertBtn = document.getElementById('pdf-to-jpg-convert-btn');
            const downloadBtn = document.getElementById('pdf-to-jpg-download-btn');
            const progressContainer = document.getElementById('pdf-to-jpg-progress-container');
            const progressFill = document.getElementById('pdf-to-jpg-progress-fill');
            const progressText = document.getElementById('pdf-to-jpg-progress-text');
            const statusContainer = document.getElementById('pdf-to-jpg-status-container');

            let selectedFile = null;
            let convertedBlobs = [];

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            async function handleFile(file) {
                selectedFile = file;
                
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    pdfToJPGOptions.style.display = 'block';
                    previewContainer.style.display = 'block';
                    convertBtn.style.display = 'block';
                    
                    previewContent.innerHTML = `<p>PDF loaded with ${pdf.numPages} pages</p>`;
                    
                } catch (error) {
                    console.error('Error reading PDF:', error);
                    showStatus('Error reading PDF', 'error', 'pdf-to-jpg-status-container');
                }
            }

            // Convert button
            convertBtn.addEventListener('click', convertToJPG);

            async function convertToJPG() {
                if (!selectedFile) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to JPEG...', 'info', 'pdf-to-jpg-status-container');

                try {
                    const arrayBuffer = await selectedFile.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    const qualityMap = { high: 0.9, medium: 0.7, low: 0.5 };
                    const quality = qualityMap[document.getElementById('jpg-quality').value];
                    const dpi = parseInt(document.getElementById('jpg-dpi').value);
                    const scale = dpi / 150;
                    const pagesOption = document.getElementById('jpg-pages').value;
                    
                    convertedBlobs = [];
                    
                    let startPage = 1;
                    let endPage = pdf.numPages;
                    
                    if (pagesOption === 'first') {
                        endPage = 1;
                    } else if (pagesOption === 'custom') {
                        // For demo, convert first 3 pages
                        endPage = Math.min(3, pdf.numPages);
                    }
                    
                    for (let i = startPage; i <= endPage; i++) {
                        const progress = ((i - startPage + 1) / (endPage - startPage + 1)) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing page ${i} of ${endPage}...`;
                        
                        const page = await pdf.getPage(i);
                        const viewport = page.getViewport({ scale: scale });
                        
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        
                        await page.render({ canvasContext: context, viewport: viewport }).promise;
                        
                        const blob = await new Promise((resolve) => {
                            canvas.toBlob(resolve, 'image/jpeg', quality);
                        });
                        
                        convertedBlobs.push({
                            blob: blob,
                            name: selectedFile.name.replace('.pdf', `_page_${i}.jpg`)
                        });
                    }
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('PDF converted to JPEG successfully!', 'success', 'pdf-to-jpg-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to JPEG', 'error', 'pdf-to-jpg-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (convertedBlobs.length === 1) {
                    // Single file download
                    const url = URL.createObjectURL(convertedBlobs[0].blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = convertedBlobs[0].name;
                    a.click();
                    URL.revokeObjectURL(url);
                } else {
                    // Multiple files - create ZIP (simplified for demo)
                    convertedBlobs.forEach(item => {
                        const url = URL.createObjectURL(item.blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = item.name;
                        a.click();
                        URL.revokeObjectURL(url);
                    });
                }
            });
        }

        // PDF to PNG Tool
        function loadPDFToPNGTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="pdf-to-png-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">Click or drag PDF here</div>
                    <div class="upload-subtext">Select a PDF to convert to PNG</div>
                    <input type="file" id="pdf-to-png-file-input" accept=".pdf" style="display: none;">
                </div>

                <div class="options-panel" id="pdf-to-png-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Image Quality</span>
                        <div class="option-control">
                            <select id="png-quality">
                                <option value="high">High</option>
                                <option value="medium" selected>Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">DPI</span>
                        <div class="option-control">
                            <select id="png-dpi">
                                <option value="150">150 DPI</option>
                                <option value="300" selected>300 DPI</option>
                                <option value="600">600 DPI</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Pages</span>
                        <div class="option-control">
                            <select id="png-pages">
                                <option value="all">All Pages</option>
                                <option value="first">First Page Only</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="pdf-to-png-preview" style="display: none;">
                    <h3>Conversion Preview</h3>
                    <div id="pdf-to-png-preview-content" style="max-height: 400px; overflow-y: auto; padding: 1rem; background: white; border-radius: 8px;">
                        <!-- Preview content will be here -->
                    </div>
                </div>

                <div class="progress-container" id="pdf-to-png-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="pdf-to-png-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="pdf-to-png-progress-text">Converting to PNG...</div>
                </div>

                <div id="pdf-to-png-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="pdf-to-png-convert-btn" style="display: none;">
                        <i class="fas fa-file-image"></i>
                        Convert to PNG
                    </button>
                    <button class="btn btn-success btn-block" id="pdf-to-png-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download PNG Images
                    </button>
                </div>
            `;

            setupPDFToPNGTool();
        }

        function setupPDFToPNGTool() {
            const uploadArea = document.getElementById('pdf-to-png-upload-area');
            const fileInput = document.getElementById('pdf-to-png-file-input');
            const pdfToPNGOptions = document.getElementById('pdf-to-png-options');
            const previewContainer = document.getElementById('pdf-to-png-preview');
            const previewContent = document.getElementById('pdf-to-png-preview-content');
            const convertBtn = document.getElementById('pdf-to-png-convert-btn');
            const downloadBtn = document.getElementById('pdf-to-png-download-btn');
            const progressContainer = document.getElementById('pdf-to-png-progress-container');
            const progressFill = document.getElementById('pdf-to-png-progress-fill');
            const progressText = document.getElementById('pdf-to-png-progress-text');
            const statusContainer = document.getElementById('pdf-to-png-status-container');

            let selectedFile = null;
            let convertedBlobs = [];

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'application/pdf') {
                    handleFile(file);
                }
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            async function handleFile(file) {
                selectedFile = file;
                
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    pdfToPNGOptions.style.display = 'block';
                    previewContainer.style.display = 'block';
                    convertBtn.style.display = 'block';
                    
                    previewContent.innerHTML = `<p>PDF loaded with ${pdf.numPages} pages</p>`;
                    
                } catch (error) {
                    console.error('Error reading PDF:', error);
                    showStatus('Error reading PDF', 'error', 'pdf-to-png-status-container');
                }
            }

            // Convert button
            convertBtn.addEventListener('click', convertToPNG);

            async function convertToPNG() {
                if (!selectedFile) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to PNG...', 'info', 'pdf-to-png-status-container');

                try {
                    const arrayBuffer = await selectedFile.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    
                    const dpi = parseInt(document.getElementById('png-dpi').value);
                    const scale = dpi / 150;
                    const pagesOption = document.getElementById('png-pages').value;
                    
                    convertedBlobs = [];
                    
                    let startPage = 1;
                    let endPage = pdf.numPages;
                    
                    if (pagesOption === 'first') {
                        endPage = 1;
                    } else if (pagesOption === 'custom') {
                        endPage = Math.min(3, pdf.numPages);
                    }
                    
                    for (let i = startPage; i <= endPage; i++) {
                        const progress = ((i - startPage + 1) / (endPage - startPage + 1)) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing page ${i} of ${endPage}...`;
                        
                        const page = await pdf.getPage(i);
                        const viewport = page.getViewport({ scale: scale });
                        
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        
                        await page.render({ canvasContext: context, viewport: viewport }).promise;
                        
                        const blob = await new Promise((resolve) => {
                            canvas.toBlob(resolve, 'image/png');
                        });
                        
                        convertedBlobs.push({
                            blob: blob,
                            name: selectedFile.name.replace('.pdf', `_page_${i}.png`)
                        });
                    }
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('PDF converted to PNG successfully!', 'success', 'pdf-to-png-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to PNG', 'error', 'pdf-to-png-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (convertedBlobs.length === 1) {
                    const url = URL.createObjectURL(convertedBlobs[0].blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = convertedBlobs[0].name;
                    a.click();
                    URL.revokeObjectURL(url);
                } else {
                    convertedBlobs.forEach(item => {
                        const url = URL.createObjectURL(item.blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = item.name;
                        a.click();
                        URL.revokeObjectURL(url);
                    });
                }
            });
        }

        // JPG to PDF Tool
        function loadJPGToPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="jpg-to-pdf-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">Click or drag JPEG images here</div>
                    <div class="upload-subtext">Select JPEG images to convert to PDF</div>
                    <input type="file" id="jpg-to-pdf-file-input" accept="image/jpeg" multiple style="display: none;">
                </div>

                <div class="file-list" id="jpg-to-pdf-file-list" style="display: none;">
                    <!-- Files will be listed here -->
                </div>

                <div class="options-panel" id="jpg-to-pdf-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Page Size</span>
                        <div class="option-control">
                            <select id="jpg-pdf-page-size">
                                <option value="a4">A4</option>
                                <option value="letter">Letter</option>
                                <option value="legal">Legal</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Orientation</span>
                        <div class="option-control">
                            <select id="jpg-pdf-orientation">
                                <option value="portrait">Portrait</option>
                                <option value="landscape">Landscape</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Image Layout</span>
                        <div class="option-control">
                            <select id="jpg-image-layout">
                                <option value="one-per-page">One Image Per Page</option>
                                <option value="fit-to-page">Fit to Page</option>
                                <option value="grid">Grid Layout</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Margin</span>
                        <div class="option-control">
                            <input type="number" id="jpg-pdf-margin" min="0" max="50" value="10">
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="jpg-to-pdf-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="jpg-to-pdf-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="jpg-to-pdf-progress-text">Converting to PDF...</div>
                </div>

                <div id="jpg-to-pdf-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="jpg-to-pdf-btn" style="display: none;">
                        <i class="fas fa-file-pdf"></i>
                        Convert to PDF
                    </button>
                    <button class="btn btn-success btn-block" id="jpg-to-pdf-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download PDF
                    </button>
                </div>
            `;

            setupJPGToPDFTool();
        }

        function setupJPGToPDFTool() {
            const uploadArea = document.getElementById('jpg-to-pdf-upload-area');
            const fileInput = document.getElementById('jpg-to-pdf-file-input');
            const fileList = document.getElementById('jpg-to-pdf-file-list');
            const pdfOptions = document.getElementById('jpg-to-pdf-options');
            const convertBtn = document.getElementById('jpg-to-pdf-btn');
            const downloadBtn = document.getElementById('jpg-to-pdf-download-btn');
            const progressContainer = document.getElementById('jpg-to-pdf-progress-container');
            const progressFill = document.getElementById('jpg-to-pdf-progress-fill');
            const progressText = document.getElementById('jpg-to-pdf-progress-text');
            const statusContainer = document.getElementById('jpg-to-pdf-status-container');

            let jpgFiles = [];
            let pdfBlob = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                const jpgFileList = files.filter(file => file.type === 'image/jpeg');
                jpgFiles.push(...jpgFileList);
                updateFileList();
            }

            function updateFileList() {
                fileList.innerHTML = '';
                
                if (jpgFiles.length === 0) {
                    fileList.style.display = 'none';
                    pdfOptions.style.display = 'none';
                    convertBtn.style.display = 'none';
                    return;
                }
                
                fileList.style.display = 'block';
                pdfOptions.style.display = 'block';
                convertBtn.style.display = 'block';
                
                jpgFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    fileItem.innerHTML = `
                        <div class="file-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="file-details">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                        </div>
                        <button class="file-remove" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    fileList.appendChild(fileItem);
                });
                
                document.querySelectorAll('.file-remove').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index);
                        jpgFiles.splice(index, 1);
                        updateFileList();
                    });
                });
            }

            // Convert button
            convertBtn.addEventListener('click', convertToPDF);

            async function convertToPDF() {
                if (jpgFiles.length === 0) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to PDF...', 'info', 'jpg-to-pdf-status-container');

                try {
                    const { jsPDF } = window.jspdf;
                    const pageSize = document.getElementById('jpg-pdf-page-size').value;
                    const orientation = document.getElementById('jpg-pdf-orientation').value;
                    const imageLayout = document.getElementById('jpg-image-layout').value;
                    const margin = parseInt(document.getElementById('jpg-pdf-margin').value);
                    
                    let pageWidth, pageHeight;
                    switch(pageSize) {
                        case 'a4':
                            pageWidth = orientation === 'portrait' ? 210 : 297;
                            pageHeight = orientation === 'portrait' ? 297 : 210;
                            break;
                        case 'letter':
                            pageWidth = orientation === 'portrait' ? 216 : 279;
                            pageHeight = orientation === 'portrait' ? 279 : 216;
                            break;
                        case 'legal':
                            pageWidth = orientation === 'portrait' ? 216 : 356;
                            pageHeight = orientation === 'portrait' ? 356 : 216;
                            break;
                    }
                    
                    const doc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    const usableWidth = pageWidth - (margin * 2);
                    const usableHeight = pageHeight - (margin * 2);
                    
                    for (let i = 0; i < jpgFiles.length; i++) {
                        const progress = ((i + 1) / jpgFiles.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing image ${i + 1} of ${jpgFiles.length}...`;
                        
                        if (i > 0) {
                            doc.addPage([pageWidth, pageHeight], orientation);
                        }
                        
                        const file = jpgFiles[i];
                        
                        const img = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => resolve(img);
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                        
                        let imgWidth, imgHeight;
                        
                        if (imageLayout === 'fit-to-page') {
                            imgWidth = usableWidth;
                            imgHeight = usableHeight;
                        } else {
                            const aspectRatio = img.width / img.height;
                            imgWidth = Math.min(usableWidth, usableHeight * aspectRatio);
                            imgHeight = imgWidth / aspectRatio;
                        }
                        
                        const x = margin + (usableWidth - imgWidth) / 2;
                        const y = margin + (usableHeight - imgHeight) / 2;
                        
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        const imgData = canvas.toDataURL('image/jpeg', 0.9);
                        doc.addImage(imgData, 'JPEG', x, y, imgWidth, imgHeight);
                    }
                    
                    pdfBlob = doc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('JPEG converted to PDF successfully!', 'success', 'jpg-to-pdf-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to PDF', 'error', 'jpg-to-pdf-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (pdfBlob) {
                    const url = URL.createObjectURL(pdfBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'converted.pdf';
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // PNG to PDF Tool
        function loadPNGToPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="png-to-pdf-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">Click or drag PNG images here</div>
                    <div class="upload-subtext">Select PNG images to convert to PDF</div>
                    <input type="file" id="png-to-pdf-file-input" accept="image/png" multiple style="display: none;">
                </div>

                <div class="file-list" id="png-to-pdf-file-list" style="display: none;">
                    <!-- Files will be listed here -->
                </div>

                <div class="options-panel" id="png-to-pdf-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Page Size</span>
                        <div class="option-control">
                            <select id="png-pdf-page-size">
                                <option value="a4">A4</option>
                                <option value="letter">Letter</option>
                                <option value="legal">Legal</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Orientation</span>
                        <div class="option-control">
                            <select id="png-pdf-orientation">
                                <option value="portrait">Portrait</option>
                                <option value="landscape">Landscape</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Image Layout</span>
                        <div class="option-control">
                            <select id="png-image-layout">
                                <option value="one-per-page">One Image Per Page</option>
                                <option value="fit-to-page">Fit to Page</option>
                                <option value="grid">Grid Layout</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Margin</span>
                        <div class="option-control">
                            <input type="number" id="png-pdf-margin" min="0" max="50" value="10">
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="png-to-pdf-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="png-to-pdf-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="png-to-pdf-progress-text">Converting to PDF...</div>
                </div>

                <div id="png-to-pdf-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="png-to-pdf-btn" style="display: none;">
                        <i class="fas fa-file-pdf"></i>
                        Convert to PDF
                    </button>
                    <button class="btn btn-success btn-block" id="png-to-pdf-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download PDF
                    </button>
                </div>
            `;

            setupPNGToPDFTool();
        }

        function setupPNGToPDFTool() {
            const uploadArea = document.getElementById('png-to-pdf-upload-area');
            const fileInput = document.getElementById('png-to-pdf-file-input');
            const fileList = document.getElementById('png-to-pdf-file-list');
            const pdfOptions = document.getElementById('png-to-pdf-options');
            const convertBtn = document.getElementById('png-to-pdf-btn');
            const downloadBtn = document.getElementById('png-to-pdf-download-btn');
            const progressContainer = document.getElementById('png-to-pdf-progress-container');
            const progressFill = document.getElementById('png-to-pdf-progress-fill');
            const progressText = document.getElementById('png-to-pdf-progress-text');
            const statusContainer = document.getElementById('png-to-pdf-status-container');

            let pngFiles = [];
            let pdfBlob = null;

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                const pngFileList = files.filter(file => file.type === 'image/png');
                pngFiles.push(...pngFileList);
                updateFileList();
            }

            function updateFileList() {
                fileList.innerHTML = '';
                
                if (pngFiles.length === 0) {
                    fileList.style.display = 'none';
                    pdfOptions.style.display = 'none';
                    convertBtn.style.display = 'none';
                    return;
                }
                
                fileList.style.display = 'block';
                pdfOptions.style.display = 'block';
                convertBtn.style.display = 'block';
                
                pngFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    fileItem.innerHTML = `
                        <div class="file-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="file-details">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                        </div>
                        <button class="file-remove" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    fileList.appendChild(fileItem);
                });
                
                document.querySelectorAll('.file-remove').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index);
                        pngFiles.splice(index, 1);
                        updateFileList();
                    });
                });
            }

            // Convert button
            convertBtn.addEventListener('click', convertToPDF);

            async function convertToPDF() {
                if (pngFiles.length === 0) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to PDF...', 'info', 'png-to-pdf-status-container');

                try {
                    const { jsPDF } = window.jspdf;
                    const pageSize = document.getElementById('png-pdf-page-size').value;
                    const orientation = document.getElementById('png-pdf-orientation').value;
                    const imageLayout = document.getElementById('png-image-layout').value;
                    const margin = parseInt(document.getElementById('png-pdf-margin').value);
                    
                    let pageWidth, pageHeight;
                    switch(pageSize) {
                        case 'a4':
                            pageWidth = orientation === 'portrait' ? 210 : 297;
                            pageHeight = orientation === 'portrait' ? 297 : 210;
                            break;
                        case 'letter':
                            pageWidth = orientation === 'portrait' ? 216 : 279;
                            pageHeight = orientation === 'portrait' ? 279 : 216;
                            break;
                        case 'legal':
                            pageWidth = orientation === 'portrait' ? 216 : 356;
                            pageHeight = orientation === 'portrait' ? 356 : 216;
                            break;
                    }
                    
                    const doc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    const usableWidth = pageWidth - (margin * 2);
                    const usableHeight = pageHeight - (margin * 2);
                    
                    for (let i = 0; i < pngFiles.length; i++) {
                        const progress = ((i + 1) / pngFiles.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing image ${i + 1} of ${pngFiles.length}...`;
                        
                        if (i > 0) {
                            doc.addPage([pageWidth, pageHeight], orientation);
                        }
                        
                        const file = pngFiles[i];
                        
                        const img = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => resolve(img);
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                        
                        let imgWidth, imgHeight;
                        
                        if (imageLayout === 'fit-to-page') {
                            imgWidth = usableWidth;
                            imgHeight = usableHeight;
                        } else {
                            const aspectRatio = img.width / img.height;
                            imgWidth = Math.min(usableWidth, usableHeight * aspectRatio);
                            imgHeight = imgWidth / aspectRatio;
                        }
                        
                        const x = margin + (usableWidth - imgWidth) / 2;
                        const y = margin + (usableHeight - imgHeight) / 2;
                        
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        const imgData = canvas.toDataURL('image/png');
                        doc.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);
                    }
                    
                    pdfBlob = doc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('PNG converted to PDF successfully!', 'success', 'png-to-pdf-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to PDF', 'error', 'png-to-pdf-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (pdfBlob) {
                    const url = URL.createObjectURL(pdfBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'converted.pdf';
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // WebP to JPG Tool
        function loadWebPToJPGTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="webp-to-jpg-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">Click or drag WebP images here</div>
                    <div class="upload-subtext">Select WebP images to convert to JPEG</div>
                    <input type="file" id="webp-to-jpg-file-input" accept="image/webp" multiple style="display: none;">
                </div>

                <div class="options-panel" id="webp-to-jpg-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">JPEG Quality</span>
                        <div class="option-control">
                            <select id="webp-jpg-quality">
                                <option value="high">High (90%)</option>
                                <option value="medium" selected>Medium (70%)</option>
                                <option value="low">Low (50%)</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Resize</span>
                        <div class="option-control">
                            <select id="webp-jpg-resize">
                                <option value="none">No Resize</option>
                                <option value="50">50%</option>
                                <option value="75">75%</option>
                                <option value="125">125%</option>
                                <option value="150">150%</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="webp-to-jpg-preview-container" style="display: none;">
                    <h3>Conversion Preview</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <h4>Original WebP</h4>
                            <img id="webp-original-preview" class="preview-image" alt="Original">
                        </div>
                        <div>
                            <h4>Converted JPEG</h4>
                            <img id="webp-converted-preview" class="preview-image" alt="Converted">
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="webp-to-jpg-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="webp-to-jpg-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="webp-to-jpg-progress-text">Converting to JPEG...</div>
                </div>

                <div id="webp-to-jpg-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="webp-to-jpg-btn" style="display: none;">
                        <i class="fas fa-exchange-alt"></i>
                        Convert to JPEG
                    </button>
                    <button class="btn btn-success btn-block" id="webp-to-jpg-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download JPEG Images
                    </button>
                </div>
            `;

            setupWebPToJPGTool();
        }

        function setupWebPToJPGTool() {
            const uploadArea = document.getElementById('webp-to-jpg-upload-area');
            const fileInput = document.getElementById('webp-to-jpg-file-input');
            const webpOptions = document.getElementById('webp-to-jpg-options');
            const previewContainer = document.getElementById('webp-to-jpg-preview-container');
            const convertBtn = document.getElementById('webp-to-jpg-btn');
            const downloadBtn = document.getElementById('webp-to-jpg-download-btn');
            const progressContainer = document.getElementById('webp-to-jpg-progress-container');
            const progressFill = document.getElementById('webp-to-jpg-progress-fill');
            const progressText = document.getElementById('webp-to-jpg-progress-text');
            const statusContainer = document.getElementById('webp-to-jpg-status-container');

            let selectedFiles = [];
            let convertedBlobs = [];

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                const webpFiles = files.filter(file => file.type === 'image/webp');
                selectedFiles = webpFiles.slice(0, 5);
                
                if (selectedFiles.length > 0) {
                    webpOptions.style.display = 'block';
                    previewContainer.style.display = 'block';
                    convertBtn.style.display = 'block';
                    
                    // Show original preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('webp-original-preview').src = e.target.result;
                        previewConversion();
                    };
                    reader.readAsDataURL(selectedFiles[0]);
                }
            }

            ['webp-jpg-quality', 'webp-jpg-resize'].forEach(id => {
                document.getElementById(id).addEventListener('change', previewConversion);
            });

            function previewConversion() {
                if (selectedFiles.length === 0) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        let newWidth = img.width;
                        let newHeight = img.height;
                        
                        const resize = document.getElementById('webp-jpg-resize').value;
                        if (resize !== 'none') {
                            const scale = parseInt(resize) / 100;
                            newWidth = Math.round(img.width * scale);
                            newHeight = Math.round(img.height * scale);
                        }
                        
                        canvas.width = newWidth;
                        canvas.height = newHeight;
                        ctx.drawImage(img, 0, 0, newWidth, newHeight);
                        
                        const qualityMap = { high: 0.9, medium: 0.7, low: 0.5 };
                        const quality = qualityMap[document.getElementById('webp-jpg-quality').value];
                        
                        canvas.toBlob((blob) => {
                            document.getElementById('webp-converted-preview').src = URL.createObjectURL(blob);
                        }, 'image/jpeg', quality);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(selectedFiles[0]);
            }

            // Convert button
            convertBtn.addEventListener('click', convertToJPG);

            async function convertToJPG() {
                if (selectedFiles.length === 0) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to JPEG...', 'info', 'webp-to-jpg-status-container');

                try {
                    const qualityMap = { high: 0.9, medium: 0.7, low: 0.5 };
                    const quality = qualityMap[document.getElementById('webp-jpg-quality').value];
                    const resize = document.getElementById('webp-jpg-resize').value;
                    convertedBlobs = [];

                    for (let i = 0; i < selectedFiles.length; i++) {
                        const file = selectedFiles[i];
                        const progress = ((i + 1) / selectedFiles.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing image ${i + 1} of ${selectedFiles.length}...`;
                        
                        const blob = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    const ctx = canvas.getContext('2d');
                                    
                                    let newWidth = img.width;
                                    let newHeight = img.height;
                                    
                                    if (resize !== 'none') {
                                        const scale = parseInt(resize) / 100;
                                        newWidth = Math.round(img.width * scale);
                                        newHeight = Math.round(img.height * scale);
                                    }
                                    
                                    canvas.width = newWidth;
                                    canvas.height = newHeight;
                                    ctx.drawImage(img, 0, 0, newWidth, newHeight);
                                    
                                    canvas.toBlob(resolve, 'image/jpeg', quality);
                                };
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                        
                        convertedBlobs.push({
                            blob: blob,
                            name: file.name.replace('.webp', '.jpg')
                        });
                    }
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('WebP converted to JPEG successfully!', 'success', 'webp-to-jpg-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to JPEG', 'error', 'webp-to-jpg-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                convertedBlobs.forEach(item => {
                    const url = URL.createObjectURL(item.blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = item.name;
                    a.click();
                    URL.revokeObjectURL(url);
                });
            });
        }

        // SVG to PNG Tool
        function loadSVGToPNGTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="svg-to-png-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-vector-square"></i>
                    </div>
                    <div class="upload-text">Click or drag SVG files here</div>
                    <div class="upload-subtext">Select SVG files to convert to PNG</div>
                    <input type="file" id="svg-to-png-file-input" accept="image/svg+xml" multiple style="display: none;">
                </div>

                <div class="options-panel" id="svg-to-png-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Output Size</span>
                        <div class="option-control">
                            <select id="svg-output-size">
                                <option value="original">Original Size</option>
                                <option value="512x512">512x512</option>
                                <option value="1024x1024">1024x1024</option>
                                <option value="2048x2048">2048x2048</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row" id="svg-custom-size" style="display: none;">
                        <span class="option-label">Custom Dimensions</span>
                        <div class="option-control">
                            <input type="number" id="svg-width" placeholder="Width" value="1024" min="1" max="4000">
                            <span>x</span>
                            <input type="number" id="svg-height" placeholder="Height" value="1024" min="1" max="4000">
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Background</span>
                        <div class="option-control">
                            <select id="svg-background">
                                <option value="transparent">Transparent</option>
                                <option value="white">White</option>
                                <option value="black">Black</option>
                                <option value="custom">Custom Color</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="svg-to-png-preview-container" style="display: none;">
                    <h3>Conversion Preview</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <h4>Original SVG</h4>
                            <div id="svg-original-preview" style="border: 1px solid #ddd; padding: 10px; min-height: 200px; display: flex; align-items: center; justify-content: center;">
                                <!-- SVG will be displayed here -->
                            </div>
                        </div>
                        <div>
                            <h4>Converted PNG</h4>
                            <img id="svg-converted-preview" class="preview-image" alt="Converted">
                        </div>
                    </div>
                </div>

                <div class="progress-container" id="svg-to-png-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="svg-to-png-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="svg-to-png-progress-text">Converting to PNG...</div>
                </div>

                <div id="svg-to-png-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="svg-to-png-btn" style="display: none;">
                        <i class="fas fa-vector-square"></i>
                        Convert to PNG
                    </button>
                    <button class="btn btn-success btn-block" id="svg-to-png-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download PNG Images
                    </button>
                </div>
            `;

            setupSVGToPNGTool();
        }

        function setupSVGToPNGTool() {
            const uploadArea = document.getElementById('svg-to-png-upload-area');
            const fileInput = document.getElementById('svg-to-png-file-input');
            const svgOptions = document.getElementById('svg-to-png-options');
            const previewContainer = document.getElementById('svg-to-png-preview-container');
            const convertBtn = document.getElementById('svg-to-png-btn');
            const downloadBtn = document.getElementById('svg-to-png-download-btn');
            const progressContainer = document.getElementById('svg-to-png-progress-container');
            const progressFill = document.getElementById('svg-to-png-progress-fill');
            const progressText = document.getElementById('svg-to-png-progress-text');
            const statusContainer = document.getElementById('svg-to-png-status-container');
            const outputSize = document.getElementById('svg-output-size');
            const customSize = document.getElementById('svg-custom-size');
            const svgWidth = document.getElementById('svg-width');
            const svgHeight = document.getElementById('svg-height');
            const background = document.getElementById('svg-background');

            let selectedFiles = [];
            let convertedBlobs = [];

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                const svgFiles = files.filter(file => file.type === 'image/svg+xml');
                selectedFiles = svgFiles.slice(0, 5);
                
                if (selectedFiles.length > 0) {
                    svgOptions.style.display = 'block';
                    previewContainer.style.display = 'block';
                    convertBtn.style.display = 'block';
                    
                    // Show original preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('svg-original-preview').innerHTML = e.target.result;
                        previewConversion();
                    };
                    reader.readAsDataURL(selectedFiles[0]);
                }
            }

            outputSize.addEventListener('change', (e) => {
                customSize.style.display = e.target.value === 'custom' ? 'flex' : 'none';
                previewConversion();
            });

            ['svg-width', 'svg-height', 'svg-background'].forEach(id => {
                document.getElementById(id).addEventListener('change', previewConversion);
            });

            function previewConversion() {
                if (selectedFiles.length === 0) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        let width, height;
                        const sizeOption = outputSize.value;
                        
                        if (sizeOption === 'original') {
                            width = img.width;
                            height = img.height;
                        } else if (sizeOption === 'custom') {
                            width = parseInt(svgWidth.value);
                            height = parseInt(svgHeight.value);
                        } else {
                            const [w, h] = sizeOption.split('x').map(Number);
                            width = w;
                            height = h;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        // Set background
                        const bgOption = background.value;
                        if (bgOption === 'white') {
                            ctx.fillStyle = 'white';
                            ctx.fillRect(0, 0, width, height);
                        } else if (bgOption === 'black') {
                            ctx.fillStyle = 'black';
                            ctx.fillRect(0, 0, width, height);
                        }
                        
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        canvas.toBlob((blob) => {
                            document.getElementById('svg-converted-preview').src = URL.createObjectURL(blob);
                        }, 'image/png');
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(selectedFiles[0]);
            }

            // Convert button
            convertBtn.addEventListener('click', convertToPNG);

            async function convertToPNG() {
                if (selectedFiles.length === 0) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to PNG...', 'info', 'svg-to-png-status-container');

                try {
                    const sizeOption = outputSize.value;
                    const bgOption = background.value;
                    convertedBlobs = [];

                    for (let i = 0; i < selectedFiles.length; i++) {
                        const file = selectedFiles[i];
                        const progress = ((i + 1) / selectedFiles.length) * 100;
                        progressFill.style.width = progress + '%';
                        progressText.textContent = `Processing SVG ${i + 1} of ${selectedFiles.length}...`;
                        
                        const blob = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    const ctx = canvas.getContext('2d');
                                    
                                    let width, height;
                                    
                                    if (sizeOption === 'original') {
                                        width = img.width;
                                        height = img.height;
                                    } else if (sizeOption === 'custom') {
                                        width = parseInt(svgWidth.value);
                                        height = parseInt(svgHeight.value);
                                    } else {
                                        const [w, h] = sizeOption.split('x').map(Number);
                                        width = w;
                                        height = h;
                                    }
                                    
                                    canvas.width = width;
                                    canvas.height = height;
                                    
                                    // Set background
                                    if (bgOption === 'white') {
                                        ctx.fillStyle = 'white';
                                        ctx.fillRect(0, 0, width, height);
                                    } else if (bgOption === 'black') {
                                        ctx.fillStyle = 'black';
                                        ctx.fillRect(0, 0, width, height);
                                    }
                                    
                                    ctx.drawImage(img, 0, 0, width, height);
                                    
                                    canvas.toBlob(resolve, 'image/png');
                                };
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                        
                        convertedBlobs.push({
                            blob: blob,
                            name: file.name.replace('.svg', '.png')
                        });
                    }
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('SVG converted to PNG successfully!', 'success', 'svg-to-png-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to PNG', 'error', 'svg-to-png-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                convertedBlobs.forEach(item => {
                    const url = URL.createObjectURL(item.blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = item.name;
                    a.click();
                    URL.revokeObjectURL(url);
                });
            });
        }

        // Text to PDF Tool
        function loadTextToPDFTool() {
            toolContent.innerHTML = `
                <div class="upload-area" id="text-to-pdf-upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="upload-text">Click or drag text files here</div>
                    <div class="upload-subtext">Select .txt files to convert to PDF</div>
                    <input type="file" id="text-to-pdf-file-input" accept=".txt" multiple style="display: none;">
                </div>

                <div class="options-panel" id="text-to-pdf-options" style="display: none;">
                    <div class="option-row">
                        <span class="option-label">Page Size</span>
                        <div class="option-control">
                            <select id="text-pdf-page-size">
                                <option value="a4">A4</option>
                                <option value="letter">Letter</option>
                                <option value="legal">Legal</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Orientation</span>
                        <div class="option-control">
                            <select id="text-pdf-orientation">
                                <option value="portrait">Portrait</option>
                                <option value="landscape">Landscape</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Font Size</span>
                        <div class="option-control">
                            <select id="text-font-size">
                                <option value="10">10pt</option>
                                <option value="12" selected>12pt</option>
                                <option value="14">14pt</option>
                                <option value="16">16pt</option>
                                <option value="18">18pt</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Font Family</span>
                        <div class="option-control">
                            <select id="text-font-family">
                                <option value="Arial">Arial</option>
                                <option value="Times New Roman">Times New Roman</option>
                                <option value="Courier New">Courier New</option>
                                <option value="Helvetica">Helvetica</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-row">
                        <span class="option-label">Margins</span>
                        <div class="option-control">
                            <input type="number" id="text-margins" min="10" max="50" value="20">
                        </div>
                    </div>
                </div>

                <div class="preview-container" id="text-to-pdf-preview" style="display: none;">
                    <h3>Text Preview</h3>
                    <div id="text-preview-content" style="max-height: 400px; overflow-y: auto; padding: 1rem; background: white; border-radius: 8px; text-align: left; font-family: monospace; white-space: pre-wrap;">
                        <!-- Text preview will be here -->
                    </div>
                </div>

                <div class="progress-container" id="text-to-pdf-progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="text-to-pdf-progress-fill"></div>
                    </div>
                    <div class="progress-text" id="text-to-pdf-progress-text">Converting to PDF...</div>
                </div>

                <div id="text-to-pdf-status-container"></div>

                <div class="btn-group">
                    <button class="btn btn-primary btn-block" id="text-to-pdf-btn" style="display: none;">
                        <i class="fas fa-file-pdf"></i>
                        Convert to PDF
                    </button>
                    <button class="btn btn-success btn-block" id="text-to-pdf-download-btn" style="display: none;">
                        <i class="fas fa-download"></i>
                        Download PDF
                    </button>
                </div>
            `;

            setupTextToPDFTool();
        }

        function setupTextToPDFTool() {
            const uploadArea = document.getElementById('text-to-pdf-upload-area');
            const fileInput = document.getElementById('text-to-pdf-file-input');
            const textOptions = document.getElementById('text-to-pdf-options');
            const previewContainer = document.getElementById('text-to-pdf-preview');
            const previewContent = document.getElementById('text-preview-content');
            const convertBtn = document.getElementById('text-to-pdf-btn');
            const downloadBtn = document.getElementById('text-to-pdf-download-btn');
            const progressContainer = document.getElementById('text-to-pdf-progress-container');
            const progressFill = document.getElementById('text-to-pdf-progress-fill');
            const progressText = document.getElementById('text-to-pdf-progress-text');
            const statusContainer = document.getElementById('text-to-pdf-status-container');

            let selectedFiles = [];
            let pdfBlob = null;
            let textContent = '';

            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            async function handleFiles(files) {
                const textFiles = files.filter(file => file.type === 'text/plain');
                selectedFiles = textFiles.slice(0, 5);
                
                if (selectedFiles.length > 0) {
                    textOptions.style.display = 'block';
                    previewContainer.style.display = 'block';
                    convertBtn.style.display = 'block';
                    
                    // Read and preview text
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        textContent = e.target.result;
                        previewContent.textContent = textContent.substring(0, 2000) + (textContent.length > 2000 ? '...' : '');
                    };
                    reader.readAsDataURL(selectedFiles[0]);
                }
            }

            // Convert button
            convertBtn.addEventListener('click', convertToPDF);

            async function convertToPDF() {
                if (selectedFiles.length === 0) return;

                convertBtn.disabled = true;
                progressContainer.style.display = 'block';
                showStatus('Converting to PDF...', 'info', 'text-to-pdf-status-container');

                try {
                    const { jsPDF } = window.jspdf;
                    const pageSize = document.getElementById('text-pdf-page-size').value;
                    const orientation = document.getElementById('text-pdf-orientation').value;
                    const fontSize = parseInt(document.getElementById('text-font-size').value);
                    const fontFamily = document.getElementById('text-font-family').value;
                    const margins = parseInt(document.getElementById('text-margins').value);
                    
                    // Set page dimensions
                    let pageWidth, pageHeight;
                    switch(pageSize) {
                        case 'a4':
                            pageWidth = orientation === 'portrait' ? 210 : 297;
                            pageHeight = orientation === 'portrait' ? 297 : 210;
                            break;
                        case 'letter':
                            pageWidth = orientation === 'portrait' ? 216 : 279;
                            pageHeight = orientation === 'portrait' ? 279 : 216;
                            break;
                        case 'legal':
                            pageWidth = orientation === 'portrait' ? 216 : 356;
                            pageHeight = orientation === 'portrait' ? 356 : 216;
                            break;
                    }
                    
                    const doc = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: [pageWidth, pageHeight]
                    });
                    
                    // Combine all text files
                    let combinedText = '';
                    for (let i = 0; i < selectedFiles.length; i++) {
                        const file = selectedFiles[i];
                        const text = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = (e) => resolve(e.target.result);
                            reader.readAsText(file);
                        });
                        
                        if (i > 0) combinedText += '\n\n';
                        combinedText += `--- ${file.name} ---\n\n`;
                        combinedText += text;
                    }
                    
                    // Add text to PDF
                    doc.setFontSize(fontSize);
                    doc.setFont(fontFamily);
                    const lineHeight = fontSize * 0.35; // Convert pt to mm
                    const usableWidth = pageWidth - (margins * 2);
                    let y = margins;
                    
                    const lines = doc.splitTextToSize(combinedText, usableWidth);
                    
                    for (let i = 0; i < lines.length; i++) {
                        if (y > pageHeight - margins) {
                            doc.addPage([pageWidth, pageHeight], orientation);
                            y = margins;
                        }
                        
                        doc.text(lines[i], margins, y);
                        y += lineHeight;
                    }
                    
                    pdfBlob = doc.output('blob');
                    
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Conversion complete!';
                    showStatus('Text converted to PDF successfully!', 'success', 'text-to-pdf-status-container');
                    
                    downloadBtn.style.display = 'block';
                    convertBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    showStatus('Error converting to PDF', 'error', 'text-to-pdf-status-container');
                    convertBtn.disabled = false;
                }
            }

            // Download button
            downloadBtn.addEventListener('click', () => {
                if (pdfBlob) {
                    const url = URL.createObjectURL(pdfBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'converted.pdf';
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });
        }

        // Utility Functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function showStatus(message, type, containerId = 'status-container') {
            const container = document.getElementById(containerId);
            const statusClass = `status-${type}`;
            
            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message ${statusClass}`;
            
            let icon = '';
            switch(type) {
                case 'success':
                    icon = '<i class="fas fa-check-circle"></i>';
                    break;
                case 'error':
                    icon = '<i class="fas fa-exclamation-circle"></i>';
                    break;
                case 'info':
                    icon = '<i class="fas fa-info-circle"></i>';
                    break;
            }
            
            statusDiv.innerHTML = `${icon} ${message}`;
            container.innerHTML = '';
            container.appendChild(statusDiv);
            
            // Auto-hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.opacity = '0';
                    setTimeout(() => statusDiv.remove(), 300);
                }, 5000);
            }
        }
    </script>
</body>
</html>
